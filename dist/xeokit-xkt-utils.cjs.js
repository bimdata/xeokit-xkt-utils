"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const FloatArrayType=Float64Array,tempMat1=new FloatArrayType(16),tempMat2=new FloatArrayType(16),tempVec4=new FloatArrayType(4),math={MIN_DOUBLE:-Number.MAX_SAFE_INTEGER,MAX_DOUBLE:Number.MAX_SAFE_INTEGER,DEGTORAD:.0174532925,RADTODEG:57.295779513,vec2:t=>new FloatArrayType(t||2),vec3:t=>new FloatArrayType(t||3),vec4:t=>new FloatArrayType(t||4),mat3:t=>new FloatArrayType(t||9),mat3ToMat4:(t,e=new FloatArrayType(16))=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0,e[4]=t[3],e[5]=t[4],e[6]=t[5],e[7]=0,e[8]=t[6],e[9]=t[7],e[10]=t[8],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e),mat4:t=>new FloatArrayType(t||16),mat4ToMat3(t,e){},createUUID:(()=>{const t=[];for(let e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return()=>{const e=4294967295*Math.random()|0,a=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return`${t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]}-${t[255&a]}${t[a>>8&255]}-${t[a>>16&15|64]}${t[a>>24&255]}-${t[63&n|128]}${t[n>>8&255]}-${t[n>>16&255]}${t[n>>24&255]}${t[255&i]}${t[i>>8&255]}${t[i>>16&255]}${t[i>>24&255]}`}})(),clamp:(t,e,a)=>Math.max(e,Math.min(a,t)),fmod(t,e){if(t<e)return console.error("math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),t;for(;e<=t;)t-=e;return t},negateVec4:(t,e)=>(e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e),addVec4:(t,e,a)=>(a||(a=t),a[0]=t[0]+e[0],a[1]=t[1]+e[1],a[2]=t[2]+e[2],a[3]=t[3]+e[3],a),addVec4Scalar:(t,e,a)=>(a||(a=t),a[0]=t[0]+e,a[1]=t[1]+e,a[2]=t[2]+e,a[3]=t[3]+e,a),addVec3:(t,e,a)=>(a||(a=t),a[0]=t[0]+e[0],a[1]=t[1]+e[1],a[2]=t[2]+e[2],a),addVec3Scalar:(t,e,a)=>(a||(a=t),a[0]=t[0]+e,a[1]=t[1]+e,a[2]=t[2]+e,a),subVec4:(t,e,a)=>(a||(a=t),a[0]=t[0]-e[0],a[1]=t[1]-e[1],a[2]=t[2]-e[2],a[3]=t[3]-e[3],a),subVec3:(t,e,a)=>(a||(a=t),a[0]=t[0]-e[0],a[1]=t[1]-e[1],a[2]=t[2]-e[2],a),subVec2:(t,e,a)=>(a||(a=t),a[0]=t[0]-e[0],a[1]=t[1]-e[1],a),subVec4Scalar:(t,e,a)=>(a||(a=t),a[0]=t[0]-e,a[1]=t[1]-e,a[2]=t[2]-e,a[3]=t[3]-e,a),subScalarVec4:(t,e,a)=>(a||(a=t),a[0]=e-t[0],a[1]=e-t[1],a[2]=e-t[2],a[3]=e-t[3],a),mulVec4:(t,e,a)=>(a||(a=t),a[0]=t[0]*e[0],a[1]=t[1]*e[1],a[2]=t[2]*e[2],a[3]=t[3]*e[3],a),mulVec4Scalar:(t,e,a)=>(a||(a=t),a[0]=t[0]*e,a[1]=t[1]*e,a[2]=t[2]*e,a[3]=t[3]*e,a),mulVec3Scalar:(t,e,a)=>(a||(a=t),a[0]=t[0]*e,a[1]=t[1]*e,a[2]=t[2]*e,a),mulVec2Scalar:(t,e,a)=>(a||(a=t),a[0]=t[0]*e,a[1]=t[1]*e,a),divVec3:(t,e,a)=>(a||(a=t),a[0]=t[0]/e[0],a[1]=t[1]/e[1],a[2]=t[2]/e[2],a),divVec4:(t,e,a)=>(a||(a=t),a[0]=t[0]/e[0],a[1]=t[1]/e[1],a[2]=t[2]/e[2],a[3]=t[3]/e[3],a),divScalarVec3:(t,e,a)=>(a||(a=e),a[0]=t/e[0],a[1]=t/e[1],a[2]=t/e[2],a),divVec3Scalar:(t,e,a)=>(a||(a=t),a[0]=t[0]/e,a[1]=t[1]/e,a[2]=t[2]/e,a),divVec4Scalar:(t,e,a)=>(a||(a=t),a[0]=t[0]/e,a[1]=t[1]/e,a[2]=t[2]/e,a[3]=t[3]/e,a),divScalarVec4:(t,e,a)=>(a||(a=e),a[0]=t/e[0],a[1]=t/e[1],a[2]=t/e[2],a[3]=t/e[3],a),dotVec4:(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],cross3Vec4(t,e){const a=t[0],n=t[1],i=t[2],r=e[0],s=e[1],o=e[2];return[n*o-i*s,i*r-a*o,a*s-n*r,0]},cross3Vec3(t,e,a){a||(a=t);const n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],l=e[2];return a[0]=i*l-r*o,a[1]=r*s-n*l,a[2]=n*o-i*s,a},sqLenVec4:t=>math.dotVec4(t,t),lenVec4:t=>Math.sqrt(math.sqLenVec4(t)),dotVec3:(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],dotVec2:(t,e)=>t[0]*e[0]+t[1]*e[1],sqLenVec3:t=>math.dotVec3(t,t),sqLenVec2:t=>math.dotVec2(t,t),lenVec3:t=>Math.sqrt(math.sqLenVec3(t)),distVec3:(()=>{const t=new FloatArrayType(3);return(e,a)=>math.lenVec3(math.subVec3(e,a,t))})(),lenVec2:t=>Math.sqrt(math.sqLenVec2(t)),distVec2:(()=>{const t=new FloatArrayType(2);return(e,a)=>math.lenVec2(math.subVec2(e,a,t))})(),rcpVec3:(t,e)=>math.divScalarVec3(1,t,e),normalizeVec4(t,e){const a=1/math.lenVec4(t);return math.mulVec4Scalar(t,a,e)},normalizeVec3(t,e){const a=1/math.lenVec3(t);return math.mulVec3Scalar(t,a,e)},normalizeVec2(t,e){const a=1/math.lenVec2(t);return math.mulVec2Scalar(t,a,e)},angleVec3(t,e){let a=math.dotVec3(t,e)/Math.sqrt(math.sqLenVec3(t)*math.sqLenVec3(e));return a=a<-1?-1:a>1?1:a,Math.acos(a)},vec3FromMat4Scale:(()=>{const t=new FloatArrayType(3);return(e,a)=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],a[0]=math.lenVec3(t),t[0]=e[4],t[1]=e[5],t[2]=e[6],a[1]=math.lenVec3(t),t[0]=e[8],t[1]=e[9],t[2]=e[10],a[2]=math.lenVec3(t),a)})(),vecToArray:(()=>{function t(t){return Math.round(1e5*t)/1e5}return e=>{for(let a=0,n=(e=Array.prototype.slice.call(e)).length;a<n;a++)e[a]=t(e[a]);return e}})(),xyzArrayToObject:t=>({x:t[0],y:t[1],z:t[2]}),xyzObjectToArray:(t,e)=>((e=e||new FloatArrayType(3))[0]=t.x,e[1]=t.y,e[2]=t.z,e),dupMat4:t=>t.slice(0,16),mat4To3:t=>[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]],m4s:t=>[t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t],setMat4ToZeroes:()=>math.m4s(0),setMat4ToOnes:()=>math.m4s(1),diagonalMat4v:t=>new FloatArrayType([t[0],0,0,0,0,t[1],0,0,0,0,t[2],0,0,0,0,t[3]]),diagonalMat4c:(t,e,a,n)=>math.diagonalMat4v([t,e,a,n]),diagonalMat4s:t=>math.diagonalMat4c(t,t,t,t),identityMat4:(t=new FloatArrayType(16))=>(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t),identityMat3:(t=new FloatArrayType(9))=>(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t),isIdentityMat4:t=>1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15],negateMat4:(t,e)=>(e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e),addMat4:(t,e,a)=>(a||(a=t),a[0]=t[0]+e[0],a[1]=t[1]+e[1],a[2]=t[2]+e[2],a[3]=t[3]+e[3],a[4]=t[4]+e[4],a[5]=t[5]+e[5],a[6]=t[6]+e[6],a[7]=t[7]+e[7],a[8]=t[8]+e[8],a[9]=t[9]+e[9],a[10]=t[10]+e[10],a[11]=t[11]+e[11],a[12]=t[12]+e[12],a[13]=t[13]+e[13],a[14]=t[14]+e[14],a[15]=t[15]+e[15],a),addMat4Scalar:(t,e,a)=>(a||(a=t),a[0]=t[0]+e,a[1]=t[1]+e,a[2]=t[2]+e,a[3]=t[3]+e,a[4]=t[4]+e,a[5]=t[5]+e,a[6]=t[6]+e,a[7]=t[7]+e,a[8]=t[8]+e,a[9]=t[9]+e,a[10]=t[10]+e,a[11]=t[11]+e,a[12]=t[12]+e,a[13]=t[13]+e,a[14]=t[14]+e,a[15]=t[15]+e,a),addScalarMat4:(t,e,a)=>math.addMat4Scalar(e,t,a),subMat4:(t,e,a)=>(a||(a=t),a[0]=t[0]-e[0],a[1]=t[1]-e[1],a[2]=t[2]-e[2],a[3]=t[3]-e[3],a[4]=t[4]-e[4],a[5]=t[5]-e[5],a[6]=t[6]-e[6],a[7]=t[7]-e[7],a[8]=t[8]-e[8],a[9]=t[9]-e[9],a[10]=t[10]-e[10],a[11]=t[11]-e[11],a[12]=t[12]-e[12],a[13]=t[13]-e[13],a[14]=t[14]-e[14],a[15]=t[15]-e[15],a),subMat4Scalar:(t,e,a)=>(a||(a=t),a[0]=t[0]-e,a[1]=t[1]-e,a[2]=t[2]-e,a[3]=t[3]-e,a[4]=t[4]-e,a[5]=t[5]-e,a[6]=t[6]-e,a[7]=t[7]-e,a[8]=t[8]-e,a[9]=t[9]-e,a[10]=t[10]-e,a[11]=t[11]-e,a[12]=t[12]-e,a[13]=t[13]-e,a[14]=t[14]-e,a[15]=t[15]-e,a),subScalarMat4:(t,e,a)=>(a||(a=e),a[0]=t-e[0],a[1]=t-e[1],a[2]=t-e[2],a[3]=t-e[3],a[4]=t-e[4],a[5]=t-e[5],a[6]=t-e[6],a[7]=t-e[7],a[8]=t-e[8],a[9]=t-e[9],a[10]=t-e[10],a[11]=t-e[11],a[12]=t-e[12],a[13]=t-e[13],a[14]=t-e[14],a[15]=t-e[15],a),mulMat4(t,e,a){a||(a=t);const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],l=t[5],h=t[6],c=t[7],d=t[8],u=t[9],m=t[10],f=t[11],p=t[12],_=t[13],g=t[14],w=t[15],b=e[0],y=e[1],v=e[2],M=e[3],A=e[4],k=e[5],x=e[6],T=e[7],B=e[8],z=e[9],E=e[10],I=e[11],O=e[12],S=e[13],V=e[14],D=e[15];return a[0]=b*n+y*o+v*d+M*p,a[1]=b*i+y*l+v*u+M*_,a[2]=b*r+y*h+v*m+M*g,a[3]=b*s+y*c+v*f+M*w,a[4]=A*n+k*o+x*d+T*p,a[5]=A*i+k*l+x*u+T*_,a[6]=A*r+k*h+x*m+T*g,a[7]=A*s+k*c+x*f+T*w,a[8]=B*n+z*o+E*d+I*p,a[9]=B*i+z*l+E*u+I*_,a[10]=B*r+z*h+E*m+I*g,a[11]=B*s+z*c+E*f+I*w,a[12]=O*n+S*o+V*d+D*p,a[13]=O*i+S*l+V*u+D*_,a[14]=O*r+S*h+V*m+D*g,a[15]=O*s+S*c+V*f+D*w,a},mulMat3(t,e,a){a||(a=new FloatArrayType(9));const n=t[0],i=t[3],r=t[6],s=t[1],o=t[4],l=t[7],h=t[2],c=t[5],d=t[8],u=e[0],m=e[3],f=e[6],p=e[1],_=e[4],g=e[7],w=e[2],b=e[5],y=e[8];return a[0]=n*u+i*p+r*w,a[3]=n*m+i*_+r*b,a[6]=n*f+i*g+r*y,a[1]=s*u+o*p+l*w,a[4]=s*m+o*_+l*b,a[7]=s*f+o*g+l*y,a[2]=h*u+c*p+d*w,a[5]=h*m+c*_+d*b,a[8]=h*f+c*g+d*y,a},mulMat4Scalar:(t,e,a)=>(a||(a=t),a[0]=t[0]*e,a[1]=t[1]*e,a[2]=t[2]*e,a[3]=t[3]*e,a[4]=t[4]*e,a[5]=t[5]*e,a[6]=t[6]*e,a[7]=t[7]*e,a[8]=t[8]*e,a[9]=t[9]*e,a[10]=t[10]*e,a[11]=t[11]*e,a[12]=t[12]*e,a[13]=t[13]*e,a[14]=t[14]*e,a[15]=t[15]*e,a),mulMat4v4(t,e,a=math.vec4()){const n=e[0],i=e[1],r=e[2],s=e[3];return a[0]=t[0]*n+t[4]*i+t[8]*r+t[12]*s,a[1]=t[1]*n+t[5]*i+t[9]*r+t[13]*s,a[2]=t[2]*n+t[6]*i+t[10]*r+t[14]*s,a[3]=t[3]*n+t[7]*i+t[11]*r+t[15]*s,a},transposeMat4(t,e){const a=t[4],n=t[14],i=t[8],r=t[13],s=t[12],o=t[9];if(!e||t===e){const e=t[1],l=t[2],h=t[3],c=t[6],d=t[7],u=t[11];return t[1]=a,t[2]=i,t[3]=s,t[4]=e,t[6]=o,t[7]=r,t[8]=l,t[9]=c,t[11]=n,t[12]=h,t[13]=d,t[14]=u,t}return e[0]=t[0],e[1]=a,e[2]=i,e[3]=s,e[4]=t[1],e[5]=t[5],e[6]=o,e[7]=r,e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=n,e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},transposeMat3(t,e){if(e===t){const a=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=a,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},determinantMat4(t){const e=t[0],a=t[1],n=t[2],i=t[3],r=t[4],s=t[5],o=t[6],l=t[7],h=t[8],c=t[9],d=t[10],u=t[11],m=t[12],f=t[13],p=t[14],_=t[15];return m*c*o*i-h*f*o*i-m*s*d*i+r*f*d*i+h*s*p*i-r*c*p*i-m*c*n*l+h*f*n*l+m*a*d*l-e*f*d*l-h*a*p*l+e*c*p*l+m*s*n*u-r*f*n*u-m*a*o*u+e*f*o*u+r*a*p*u-e*s*p*u-h*s*n*_+r*c*n*_+h*a*o*_-e*c*o*_-r*a*d*_+e*s*d*_},inverseMat4(t,e){e||(e=t);const a=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],l=t[6],h=t[7],c=t[8],d=t[9],u=t[10],m=t[11],f=t[12],p=t[13],_=t[14],g=t[15],w=a*o-n*s,b=a*l-i*s,y=a*h-r*s,v=n*l-i*o,M=n*h-r*o,A=i*h-r*l,k=c*p-d*f,x=c*_-u*f,T=c*g-m*f,B=d*_-u*p,z=d*g-m*p,E=u*g-m*_,I=1/(w*E-b*z+y*B+v*T-M*x+A*k);return e[0]=(o*E-l*z+h*B)*I,e[1]=(-n*E+i*z-r*B)*I,e[2]=(p*A-_*M+g*v)*I,e[3]=(-d*A+u*M-m*v)*I,e[4]=(-s*E+l*T-h*x)*I,e[5]=(a*E-i*T+r*x)*I,e[6]=(-f*A+_*y-g*b)*I,e[7]=(c*A-u*y+m*b)*I,e[8]=(s*z-o*T+h*k)*I,e[9]=(-a*z+n*T-r*k)*I,e[10]=(f*M-p*y+g*w)*I,e[11]=(-c*M+d*y-m*w)*I,e[12]=(-s*B+o*x-l*k)*I,e[13]=(a*B-n*x+i*k)*I,e[14]=(-f*v+p*b-_*w)*I,e[15]=(c*v-d*b+u*w)*I,e},traceMat4:t=>t[0]+t[5]+t[10]+t[15],translationMat4v(t,e){const a=e||math.identityMat4();return a[12]=t[0],a[13]=t[1],a[14]=t[2],a},translationMat3v(t,e){const a=e||math.identityMat3();return a[6]=t[0],a[7]=t[1],a},translationMat4c:(()=>{const t=new FloatArrayType(3);return(e,a,n,i)=>(t[0]=e,t[1]=a,t[2]=n,math.translationMat4v(t,i))})(),translationMat4s:(t,e)=>math.translationMat4c(t,t,t,e),translateMat4v:(t,e)=>math.translateMat4c(t[0],t[1],t[2],e),OLDtranslateMat4c(t,e,a,n){const i=n[12];n[0]+=i*t,n[4]+=i*e,n[8]+=i*a;const r=n[13];n[1]+=r*t,n[5]+=r*e,n[9]+=r*a;const s=n[14];n[2]+=s*t,n[6]+=s*e,n[10]+=s*a;const o=n[15];return n[3]+=o*t,n[7]+=o*e,n[11]+=o*a,n},translateMat4c(t,e,a,n){const i=n[3];n[0]+=i*t,n[1]+=i*e,n[2]+=i*a;const r=n[7];n[4]+=r*t,n[5]+=r*e,n[6]+=r*a;const s=n[11];n[8]+=s*t,n[9]+=s*e,n[10]+=s*a;const o=n[15];return n[12]+=o*t,n[13]+=o*e,n[14]+=o*a,n},rotationMat4v(t,e,a){const n=math.normalizeVec4([e[0],e[1],e[2],0],[]),i=Math.sin(t),r=Math.cos(t),s=1-r,o=n[0],l=n[1],h=n[2];let c,d,u,m,f,p;return c=o*l,d=l*h,u=h*o,m=o*i,f=l*i,p=h*i,(a=a||math.mat4())[0]=s*o*o+r,a[1]=s*c+p,a[2]=s*u-f,a[3]=0,a[4]=s*c-p,a[5]=s*l*l+r,a[6]=s*d+m,a[7]=0,a[8]=s*u+f,a[9]=s*d-m,a[10]=s*h*h+r,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},rotationMat4c:(t,e,a,n,i)=>math.rotationMat4v(t,[e,a,n],i),scalingMat4v:(t,e=math.identityMat4())=>(e[0]=t[0],e[5]=t[1],e[10]=t[2],e),scalingMat3v:(t,e=math.identityMat3())=>(e[0]=t[0],e[4]=t[1],e),scalingMat4c:(()=>{const t=new FloatArrayType(3);return(e,a,n,i)=>(t[0]=e,t[1]=a,t[2]=n,math.scalingMat4v(t,i))})(),scaleMat4c:(t,e,a,n)=>(n[0]*=t,n[4]*=e,n[8]*=a,n[1]*=t,n[5]*=e,n[9]*=a,n[2]*=t,n[6]*=e,n[10]*=a,n[3]*=t,n[7]*=e,n[11]*=a,n),scaleMat4v(t,e){const a=t[0],n=t[1],i=t[2];return e[0]*=a,e[4]*=n,e[8]*=i,e[1]*=a,e[5]*=n,e[9]*=i,e[2]*=a,e[6]*=n,e[10]*=i,e[3]*=a,e[7]*=n,e[11]*=i,e},scalingMat4s:t=>math.scalingMat4c(t,t,t),rotationTranslationMat4(t,e,a=math.mat4()){const n=t[0],i=t[1],r=t[2],s=t[3],o=n+n,l=i+i,h=r+r,c=n*o,d=n*l,u=n*h,m=i*l,f=i*h,p=r*h,_=s*o,g=s*l,w=s*h;return a[0]=1-(m+p),a[1]=d+w,a[2]=u-g,a[3]=0,a[4]=d-w,a[5]=1-(c+p),a[6]=f+_,a[7]=0,a[8]=u+g,a[9]=f-_,a[10]=1-(c+m),a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a},mat4ToEuler(t,e,a=math.vec4()){const n=math.clamp,i=t[0],r=t[4],s=t[8],o=t[1],l=t[5],h=t[9],c=t[2],d=t[6],u=t[10];return"XYZ"===e?(a[1]=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(a[0]=Math.atan2(-h,u),a[2]=Math.atan2(-r,i)):(a[0]=Math.atan2(d,l),a[2]=0)):"YXZ"===e?(a[0]=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(a[1]=Math.atan2(s,u),a[2]=Math.atan2(o,l)):(a[1]=Math.atan2(-c,i),a[2]=0)):"ZXY"===e?(a[0]=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(a[1]=Math.atan2(-c,u),a[2]=Math.atan2(-r,l)):(a[1]=0,a[2]=Math.atan2(o,i))):"ZYX"===e?(a[1]=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(a[0]=Math.atan2(d,u),a[2]=Math.atan2(o,i)):(a[0]=0,a[2]=Math.atan2(-r,l))):"YZX"===e?(a[2]=Math.asin(n(o,-1,1)),Math.abs(o)<.99999?(a[0]=Math.atan2(-h,l),a[1]=Math.atan2(-c,i)):(a[0]=0,a[1]=Math.atan2(s,u))):"XZY"===e&&(a[2]=Math.asin(-n(r,-1,1)),Math.abs(r)<.99999?(a[0]=Math.atan2(d,l),a[1]=Math.atan2(s,i)):(a[0]=Math.atan2(-h,u),a[1]=0)),a},composeMat4:(t,e,a,n=math.mat4())=>(math.quaternionToRotationMat4(e,n),math.scaleMat4v(a,n),math.translateMat4v(t,n),n),decomposeMat4:(()=>{const t=new FloatArrayType(3),e=new FloatArrayType(16);return function(a,n,i,r){t[0]=a[0],t[1]=a[1],t[2]=a[2];let s=math.lenVec3(t);t[0]=a[4],t[1]=a[5],t[2]=a[6];const o=math.lenVec3(t);t[8]=a[8],t[9]=a[9],t[10]=a[10];const l=math.lenVec3(t);math.determinantMat4(a)<0&&(s=-s),n[0]=a[12],n[1]=a[13],n[2]=a[14],e.set(a);const h=1/s,c=1/o,d=1/l;return e[0]*=h,e[1]*=h,e[2]*=h,e[4]*=c,e[5]*=c,e[6]*=c,e[8]*=d,e[9]*=d,e[10]*=d,math.mat4ToQuaternion(e,i),r[0]=s,r[1]=o,r[2]=l,this}})(),lookAtMat4v(t,e,a,n){n||(n=math.mat4());const i=t[0],r=t[1],s=t[2],o=a[0],l=a[1],h=a[2],c=e[0],d=e[1],u=e[2];if(i===c&&r===d&&s===u)return math.identityMat4();let m,f,p,_,g,w,b,y,v,M;return m=i-c,f=r-d,p=s-u,_=l*(p*=M=1/Math.sqrt(m*m+f*f+p*p))-h*(f*=M),g=h*(m*=M)-o*p,w=o*f-l*m,(M=Math.sqrt(_*_+g*g+w*w))?(_*=M=1/M,g*=M,w*=M):(_=0,g=0,w=0),b=f*w-p*g,y=p*_-m*w,v=m*g-f*_,(M=Math.sqrt(b*b+y*y+v*v))?(b*=M=1/M,y*=M,v*=M):(b=0,y=0,v=0),n[0]=_,n[1]=b,n[2]=m,n[3]=0,n[4]=g,n[5]=y,n[6]=f,n[7]=0,n[8]=w,n[9]=v,n[10]=p,n[11]=0,n[12]=-(_*i+g*r+w*s),n[13]=-(b*i+y*r+v*s),n[14]=-(m*i+f*r+p*s),n[15]=1,n},lookAtMat4c:(t,e,a,n,i,r,s,o,l)=>math.lookAtMat4v([t,e,a],[n,i,r],[s,o,l],[]),orthoMat4c(t,e,a,n,i,r,s){s||(s=math.mat4());const o=e-t,l=n-a,h=r-i;return s[0]=2/o,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/l,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2/h,s[11]=0,s[12]=-(t+e)/o,s[13]=-(n+a)/l,s[14]=-(r+i)/h,s[15]=1,s},frustumMat4v(t,e,a){a||(a=math.mat4());const n=[t[0],t[1],t[2],0],i=[e[0],e[1],e[2],0];math.addVec4(i,n,tempMat1),math.subVec4(i,n,tempMat2);const r=2*n[2],s=tempMat2[0],o=tempMat2[1],l=tempMat2[2];return a[0]=r/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r/o,a[6]=0,a[7]=0,a[8]=tempMat1[0]/s,a[9]=tempMat1[1]/o,a[10]=-tempMat1[2]/l,a[11]=-1,a[12]=0,a[13]=0,a[14]=-r*i[2]/l,a[15]=0,a},frustumMat4(t,e,a,n,i,r,s){s||(s=math.mat4());const o=e-t,l=n-a,h=r-i;return s[0]=2*i/o,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*i/l,s[6]=0,s[7]=0,s[8]=(e+t)/o,s[9]=(n+a)/l,s[10]=-(r+i)/h,s[11]=-1,s[12]=0,s[13]=0,s[14]=-r*i*2/h,s[15]=0,s},perspectiveMat4(t,e,a,n,i){const r=[],s=[];return r[2]=a,s[2]=n,s[1]=r[2]*Math.tan(t/2),r[1]=-s[1],s[0]=s[1]*e,r[0]=-s[0],math.frustumMat4v(r,s,i)},transformPoint3(t,e,a=math.vec3()){const n=e[0],i=e[1],r=e[2];return a[0]=t[0]*n+t[4]*i+t[8]*r+t[12],a[1]=t[1]*n+t[5]*i+t[9]*r+t[13],a[2]=t[2]*n+t[6]*i+t[10]*r+t[14],a},transformPoint4:(t,e,a=math.vec4())=>(a[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],a[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],a[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],a[3]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],a),transformPoints3(t,e,a){const n=a||[],i=e.length;let r,s,o,l;const h=t[0],c=t[1],d=t[2],u=t[3],m=t[4],f=t[5],p=t[6],_=t[7],g=t[8],w=t[9],b=t[10],y=t[11],v=t[12],M=t[13],A=t[14],k=t[15];let x;for(let t=0;t<i;++t)r=(l=e[t])[0],s=l[1],o=l[2],(x=n[t]||(n[t]=[0,0,0]))[0]=h*r+m*s+g*o+v,x[1]=c*r+f*s+w*o+M,x[2]=d*r+p*s+b*o+A,x[3]=u*r+_*s+y*o+k;return n.length=i,n},transformPositions3(t,e,a=e){let n;const i=e.length;let r,s,o;const l=t[0],h=t[1],c=t[2],d=t[3],u=t[4],m=t[5],f=t[6],p=t[7],_=t[8],g=t[9],w=t[10],b=t[11],y=t[12],v=t[13],M=t[14],A=t[15];for(n=0;n<i;n+=3)r=e[n+0],s=e[n+1],o=e[n+2],a[n+0]=l*r+u*s+_*o+y,a[n+1]=h*r+m*s+g*o+v,a[n+2]=c*r+f*s+w*o+M,a[n+3]=d*r+p*s+b*o+A;return a},transformPositions4(t,e,a=e){let n;const i=e.length;let r,s,o;const l=t[0],h=t[1],c=t[2],d=t[3],u=t[4],m=t[5],f=t[6],p=t[7],_=t[8],g=t[9],w=t[10],b=t[11],y=t[12],v=t[13],M=t[14],A=t[15];for(n=0;n<i;n+=4)r=e[n+0],s=e[n+1],o=e[n+2],a[n+0]=l*r+u*s+_*o+y,a[n+1]=h*r+m*s+g*o+v,a[n+2]=c*r+f*s+w*o+M,a[n+3]=d*r+p*s+b*o+A;return a},transformVec3(t,e,a){const n=e[0],i=e[1],r=e[2];return(a=a||this.vec3())[0]=t[0]*n+t[4]*i+t[8]*r,a[1]=t[1]*n+t[5]*i+t[9]*r,a[2]=t[2]*n+t[6]*i+t[10]*r,a},transformVec4(t,e,a){const n=e[0],i=e[1],r=e[2],s=e[3];return(a=a||math.vec4())[0]=t[0]*n+t[4]*i+t[8]*r+t[12]*s,a[1]=t[1]*n+t[5]*i+t[9]*r+t[13]*s,a[2]=t[2]*n+t[6]*i+t[10]*r+t[14]*s,a[3]=t[3]*n+t[7]*i+t[11]*r+t[15]*s,a},rotateVec3X(t,e,a,n){const i=[],r=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],r[0]=i[0],r[1]=i[1]*Math.cos(a)-i[2]*Math.sin(a),r[2]=i[1]*Math.sin(a)+i[2]*Math.cos(a),n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n},rotateVec3Y(t,e,a,n){const i=[],r=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],r[0]=i[2]*Math.sin(a)+i[0]*Math.cos(a),r[1]=i[1],r[2]=i[2]*Math.cos(a)-i[0]*Math.sin(a),n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n},rotateVec3Z(t,e,a,n){const i=[],r=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],r[0]=i[0]*Math.cos(a)-i[1]*Math.sin(a),r[1]=i[0]*Math.sin(a)+i[1]*Math.cos(a),r[2]=i[2],n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n},projectVec4(t,e){const a=1/t[3];return(e=e||math.vec2())[0]=v[0]*a,e[1]=v[1]*a,e},unprojectVec3:(()=>{const t=new FloatArrayType(16),e=new FloatArrayType(16),a=new FloatArrayType(16);return function(n,i,r,s){return this.transformVec3(this.mulMat4(this.inverseMat4(i,t),this.inverseMat4(r,e),a),n,s)}})(),lerpVec3(t,e,a,n,i,r){const s=r||math.vec3(),o=(t-e)/(a-e);return s[0]=n[0]+o*(i[0]-n[0]),s[1]=n[1]+o*(i[1]-n[1]),s[2]=n[2]+o*(i[2]-n[2]),s},flatten(t){const e=[];let a,n,i,r,s;for(a=0,n=t.length;a<n;a++)for(i=0,r=(s=t[a]).length;i<r;i++)e.push(s[i]);return e},identityQuaternion:(t=math.vec4())=>(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t),eulerToQuaternion(t,e,a=math.vec4()){const n=t[0]*math.DEGTORAD/2,i=t[1]*math.DEGTORAD/2,r=t[2]*math.DEGTORAD/2,s=Math.cos(n),o=Math.cos(i),l=Math.cos(r),h=Math.sin(n),c=Math.sin(i),d=Math.sin(r);return"XYZ"===e?(a[0]=h*o*l+s*c*d,a[1]=s*c*l-h*o*d,a[2]=s*o*d+h*c*l,a[3]=s*o*l-h*c*d):"YXZ"===e?(a[0]=h*o*l+s*c*d,a[1]=s*c*l-h*o*d,a[2]=s*o*d-h*c*l,a[3]=s*o*l+h*c*d):"ZXY"===e?(a[0]=h*o*l-s*c*d,a[1]=s*c*l+h*o*d,a[2]=s*o*d+h*c*l,a[3]=s*o*l-h*c*d):"ZYX"===e?(a[0]=h*o*l-s*c*d,a[1]=s*c*l+h*o*d,a[2]=s*o*d-h*c*l,a[3]=s*o*l+h*c*d):"YZX"===e?(a[0]=h*o*l+s*c*d,a[1]=s*c*l+h*o*d,a[2]=s*o*d-h*c*l,a[3]=s*o*l-h*c*d):"XZY"===e&&(a[0]=h*o*l-s*c*d,a[1]=s*c*l-h*o*d,a[2]=s*o*d+h*c*l,a[3]=s*o*l+h*c*d),a},mat4ToQuaternion(t,e=math.vec4()){const a=t[0],n=t[4],i=t[8],r=t[1],s=t[5],o=t[9],l=t[2],h=t[6],c=t[10];let d;const u=a+s+c;return u>0?(d=.5/Math.sqrt(u+1),e[3]=.25/d,e[0]=(h-o)*d,e[1]=(i-l)*d,e[2]=(r-n)*d):a>s&&a>c?(d=2*Math.sqrt(1+a-s-c),e[3]=(h-o)/d,e[0]=.25*d,e[1]=(n+r)/d,e[2]=(i+l)/d):s>c?(d=2*Math.sqrt(1+s-a-c),e[3]=(i-l)/d,e[0]=(n+r)/d,e[1]=.25*d,e[2]=(o+h)/d):(d=2*Math.sqrt(1+c-a-s),e[3]=(r-n)/d,e[0]=(i+l)/d,e[1]=(o+h)/d,e[2]=.25*d),e},vec3PairToQuaternion(t,e,a=math.vec4()){const n=Math.sqrt(math.dotVec3(t,t)*math.dotVec3(e,e));let i=n+math.dotVec3(t,e);return i<1e-8*n?(i=0,Math.abs(t[0])>Math.abs(t[2])?(a[0]=-t[1],a[1]=t[0],a[2]=0):(a[0]=0,a[1]=-t[2],a[2]=t[1])):math.cross3Vec3(t,e,a),a[3]=i,math.normalizeQuaternion(a)},angleAxisToQuaternion(t,e=math.vec4()){const a=t[3]/2,n=Math.sin(a);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(a),e},quaternionToEuler:(()=>{const t=new FloatArrayType(16);return(e,a,n)=>(n=n||math.vec3(),math.quaternionToRotationMat4(e,t),math.mat4ToEuler(t,a,n),n)})(),mulQuaternions(t,e,a=math.vec4()){const n=t[0],i=t[1],r=t[2],s=t[3],o=e[0],l=e[1],h=e[2],c=e[3];return a[0]=s*o+n*c+i*h-r*l,a[1]=s*l+i*c+r*o-n*h,a[2]=s*h+r*c+n*l-i*o,a[3]=s*c-n*o-i*l-r*h,a},vec3ApplyQuaternion(t,e,a=math.vec3()){const n=e[0],i=e[1],r=e[2],s=t[0],o=t[1],l=t[2],h=t[3],c=h*n+o*r-l*i,d=h*i+l*n-s*r,u=h*r+s*i-o*n,m=-s*n-o*i-l*r;return a[0]=c*h+m*-s+d*-l-u*-o,a[1]=d*h+m*-o+u*-s-c*-l,a[2]=u*h+m*-l+c*-o-d*-s,a},quaternionToMat4(t,e){e=math.identityMat4(e);const a=t[0],n=t[1],i=t[2],r=t[3],s=2*a,o=2*n,l=2*i,h=s*r,c=o*r,d=l*r,u=s*a,m=o*a,f=l*a,p=o*n,_=l*n,g=l*i;return e[0]=1-(p+g),e[1]=m+d,e[2]=f-c,e[4]=m-d,e[5]=1-(u+g),e[6]=_+h,e[8]=f+c,e[9]=_-h,e[10]=1-(u+p),e},quaternionToRotationMat4(t,e){const a=t[0],n=t[1],i=t[2],r=t[3],s=a+a,o=n+n,l=i+i,h=a*s,c=a*o,d=a*l,u=n*o,m=n*l,f=i*l,p=r*s,_=r*o,g=r*l;return e[0]=1-(u+f),e[4]=c-g,e[8]=d+_,e[1]=c+g,e[5]=1-(h+f),e[9]=m-p,e[2]=d-_,e[6]=m+p,e[10]=1-(h+u),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},normalizeQuaternion(t,e=t){const a=math.lenVec4([t[0],t[1],t[2],t[3]]);return e[0]=t[0]/a,e[1]=t[1]/a,e[2]=t[2]/a,e[3]=t[3]/a,e},conjugateQuaternion:(t,e=t)=>(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e),inverseQuaternion:(t,e)=>math.normalizeQuaternion(math.conjugateQuaternion(t,e)),quaternionToAngleAxis(t,e=math.vec4()){const a=(t=math.normalizeQuaternion(t,tempVec4))[3],n=2*Math.acos(a),i=Math.sqrt(1-a*a);return i<.001?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i),e[3]=n,e},AABB3:t=>new FloatArrayType(t||6),AABB2:t=>new FloatArrayType(t||4),OBB3:t=>new FloatArrayType(t||32),OBB2:t=>new FloatArrayType(t||16),Sphere3:(t,e,a,n)=>new FloatArrayType([t,e,a,n]),transformOBB3(t,e,a=e){let n;const i=e.length;let r,s,o;const l=t[0],h=t[1],c=t[2],d=t[3],u=t[4],m=t[5],f=t[6],p=t[7],_=t[8],g=t[9],w=t[10],b=t[11],y=t[12],v=t[13],M=t[14],A=t[15];for(n=0;n<i;n+=4)r=e[n+0],s=e[n+1],o=e[n+2],a[n+0]=l*r+u*s+_*o+y,a[n+1]=h*r+m*s+g*o+v,a[n+2]=c*r+f*s+w*o+M,a[n+3]=d*r+p*s+b*o+A;return a},containsAABB3:function(t,e){return t[0]<=e[0]&&e[3]<=t[3]&&t[1]<=e[1]&&e[4]<=t[4]&&t[2]<=e[2]&&e[5]<=t[5]},getAABB3Diag:(()=>{const t=new FloatArrayType(3),e=new FloatArrayType(3),a=new FloatArrayType(3);return n=>(t[0]=n[0],t[1]=n[1],t[2]=n[2],e[0]=n[3],e[1]=n[4],e[2]=n[5],math.subVec3(e,t,a),Math.abs(math.lenVec3(a)))})(),getAABB3DiagPoint:(()=>{const t=new FloatArrayType(3),e=new FloatArrayType(3),a=new FloatArrayType(3);return(n,i)=>{t[0]=n[0],t[1]=n[1],t[2]=n[2],e[0]=n[3],e[1]=n[4],e[2]=n[5];const r=math.subVec3(e,t,a),s=i[0]-n[0],o=n[3]-i[0],l=i[1]-n[1],h=n[4]-i[1],c=i[2]-n[2],d=n[5]-i[2];return r[0]+=s>o?s:o,r[1]+=l>h?l:h,r[2]+=c>d?c:d,Math.abs(math.lenVec3(r))}})(),getAABB3Center(t,e){const a=e||math.vec3();return a[0]=(t[0]+t[3])/2,a[1]=(t[1]+t[4])/2,a[2]=(t[2]+t[5])/2,a},getAABB2Center(t,e){const a=e||math.vec2();return a[0]=(t[2]+t[0])/2,a[1]=(t[3]+t[1])/2,a},collapseAABB3:(t=math.AABB3())=>(t[0]=math.MAX_DOUBLE,t[1]=math.MAX_DOUBLE,t[2]=math.MAX_DOUBLE,t[3]=-math.MAX_DOUBLE,t[4]=-math.MAX_DOUBLE,t[5]=-math.MAX_DOUBLE,t),AABB3ToOBB3:(t,e=math.OBB3())=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=1,e[4]=t[3],e[5]=t[1],e[6]=t[2],e[7]=1,e[8]=t[3],e[9]=t[4],e[10]=t[2],e[11]=1,e[12]=t[0],e[13]=t[4],e[14]=t[2],e[15]=1,e[16]=t[0],e[17]=t[1],e[18]=t[5],e[19]=1,e[20]=t[3],e[21]=t[1],e[22]=t[5],e[23]=1,e[24]=t[3],e[25]=t[4],e[26]=t[5],e[27]=1,e[28]=t[0],e[29]=t[4],e[30]=t[5],e[31]=1,e),positions3ToAABB3:(()=>{const t=new FloatArrayType(3);return(e,a,n)=>{a=a||math.AABB3();let i,r,s,o=math.MAX_DOUBLE,l=math.MAX_DOUBLE,h=math.MAX_DOUBLE,c=-math.MAX_DOUBLE,d=-math.MAX_DOUBLE,u=-math.MAX_DOUBLE;for(let a=0,m=e.length;a<m;a+=3)n?(t[0]=e[a+0],t[1]=e[a+1],t[2]=e[a+2],math.decompressPosition(t,n,t),i=t[0],r=t[1],s=t[2]):(i=e[a+0],r=e[a+1],s=e[a+2]),i<o&&(o=i),r<l&&(l=r),s<h&&(h=s),i>c&&(c=i),r>d&&(d=r),s>u&&(u=s);return a[0]=o,a[1]=l,a[2]=h,a[3]=c,a[4]=d,a[5]=u,a}})(),OBB3ToAABB3(t,e=math.AABB3()){let a,n,i,r=math.MAX_DOUBLE,s=math.MAX_DOUBLE,o=math.MAX_DOUBLE,l=-math.MAX_DOUBLE,h=-math.MAX_DOUBLE,c=-math.MAX_DOUBLE;for(let e=0,d=t.length;e<d;e+=4)a=t[e+0],n=t[e+1],i=t[e+2],a<r&&(r=a),n<s&&(s=n),i<o&&(o=i),a>l&&(l=a),n>h&&(h=n),i>c&&(c=i);return e[0]=r,e[1]=s,e[2]=o,e[3]=l,e[4]=h,e[5]=c,e},points3ToAABB3(t,e=math.AABB3()){let a,n,i,r=math.MAX_DOUBLE,s=math.MAX_DOUBLE,o=math.MAX_DOUBLE,l=-math.MAX_DOUBLE,h=-math.MAX_DOUBLE,c=-math.MAX_DOUBLE;for(let e=0,d=t.length;e<d;e++)a=t[e][0],n=t[e][1],i=t[e][2],a<r&&(r=a),n<s&&(s=n),i<o&&(o=i),a>l&&(l=a),n>h&&(h=n),i>c&&(c=i);return e[0]=r,e[1]=s,e[2]=o,e[3]=l,e[4]=h,e[5]=c,e},points3ToSphere3:(()=>{const t=new FloatArrayType(3);return(e,a)=>{a=a||math.vec4();let n,i=0,r=0,s=0;const o=e.length;for(n=0;n<o;n++)i+=e[n][0],r+=e[n][1],s+=e[n][2];a[0]=i/o,a[1]=r/o,a[2]=s/o;let l,h=0;for(n=0;n<o;n++)(l=Math.abs(math.lenVec3(math.subVec3(e[n],a,t))))>h&&(h=l);return a[3]=h,a}})(),positions3ToSphere3:(()=>{const t=new FloatArrayType(3),e=new FloatArrayType(3);return(a,n)=>{n=n||math.vec4();let i,r=0,s=0,o=0;const l=a.length;let h=0;for(i=0;i<l;i+=3)r+=a[i],s+=a[i+1],o+=a[i+2];const c=l/3;let d;for(n[0]=r/c,n[1]=s/c,n[2]=o/c,i=0;i<l;i+=3)t[0]=a[i],t[1]=a[i+1],t[2]=a[i+2],(d=Math.abs(math.lenVec3(math.subVec3(t,n,e))))>h&&(h=d);return n[3]=h,n}})(),OBB3ToSphere3:(()=>{const t=new FloatArrayType(3),e=new FloatArrayType(3);return(a,n)=>{n=n||math.vec4();let i,r=0,s=0,o=0;const l=a.length,h=l/4;for(i=0;i<l;i+=4)r+=a[i+0],s+=a[i+1],o+=a[i+2];n[0]=r/h,n[1]=s/h,n[2]=o/h;let c,d=0;for(i=0;i<l;i+=4)t[0]=a[i+0],t[1]=a[i+1],t[2]=a[i+2],(c=Math.abs(math.lenVec3(math.subVec3(t,n,e))))>d&&(d=c);return n[3]=d,n}})(),getSphere3Center:(t,e=math.vec3())=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e),expandAABB3:(t,e)=>(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]>e[2]&&(t[2]=e[2]),t[3]<e[3]&&(t[3]=e[3]),t[4]<e[4]&&(t[4]=e[4]),t[5]<e[5]&&(t[5]=e[5]),t),expandAABB3Point3:(t,e)=>(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]>e[2]&&(t[2]=e[2]),t[3]<e[0]&&(t[3]=e[0]),t[4]<e[1]&&(t[4]=e[1]),t[5]<e[2]&&(t[5]=e[2]),t)};var quantizePositions=function(t,e,a,n){const i=a[0],r=a[1],s=a[2],o=65535/(a[3]-i),l=65535/(a[4]-r),h=65535/(a[5]-s);let c;for(c=0;c<e;c+=3)n[c+0]=Math.floor((t[c+0]-i)*o),n[c+1]=Math.floor((t[c+1]-r)*l),n[c+2]=Math.floor((t[c+2]-s)*h)},createPositionsDecodeMatrix=function(){const t=math.mat4(),e=math.mat4();return function(a,n){n=n||math.mat4();const i=a[0],r=a[1],s=a[2],o=a[3]-i,l=a[4]-r,h=a[5]-s;return math.identityMat4(t),math.translationMat4v(a,t),math.identityMat4(e),math.scalingMat4v([o/65535,l/65535,h/65535],e),math.mulMat4(t,e,n),n}}();function transformAndOctEncodeNormals(t,e,a,n,i){let r,s,o,l,h,c,d=math.vec3(),u=math.vec3();for(c=0;c<a;c+=3)d[0]=e[c],d[1]=e[c+1],d[2]=e[c+2],math.transformVec3(t,d,u),math.normalizeVec3(u,u),o=r=octEncodeVec3(u,0,"floor","floor"),l=h=dot(u,0,s=octDecodeVec2(r)),(l=dot(u,0,s=octDecodeVec2(r=octEncodeVec3(u,0,"ceil","floor"))))>h&&(o=r,h=l),(l=dot(u,0,s=octDecodeVec2(r=octEncodeVec3(u,0,"floor","ceil"))))>h&&(o=r,h=l),(l=dot(u,0,s=octDecodeVec2(r=octEncodeVec3(u,0,"ceil","ceil"))))>h&&(o=r,h=l),n[i+c+0]=o[0],n[i+c+1]=o[1],n[i+c+2]=0;return i+=a}function octEncodeNormals(t,e,a,n){let i,r,s,o,l;for(let h=0;h<e;h+=3)s=i=octEncodeVec3(t,h,"floor","floor"),o=l=dot(t,h,r=octDecodeVec2(i)),(o=dot(t,h,r=octDecodeVec2(i=octEncodeVec3(t,h,"ceil","floor"))))>l&&(s=i,l=o),(o=dot(t,h,r=octDecodeVec2(i=octEncodeVec3(t,h,"floor","ceil"))))>l&&(s=i,l=o),(o=dot(t,h,r=octDecodeVec2(i=octEncodeVec3(t,h,"ceil","ceil"))))>l&&(s=i,l=o),a[n+h+0]=s[0],a[n+h+1]=s[1],a[n+h+2]=0;return n+=e}function octEncodeVec3(t,e,a,n){let i=t[e]/(Math.abs(t[e])+Math.abs(t[e+1])+Math.abs(t[e+2])),r=t[e+1]/(Math.abs(t[e])+Math.abs(t[e+1])+Math.abs(t[e+2]));if(t[e+2]<0){let t=(1-Math.abs(r))*(i>=0?1:-1),e=(1-Math.abs(i))*(r>=0?1:-1);i=t,r=e}return new Int8Array([Math[a](127.5*i+(i<0?-1:0)),Math[n](127.5*r+(r<0?-1:0))])}function octDecodeVec2(t){let e=t[0],a=t[1];e/=e<0?127:128,a/=a<0?127:128;const n=1-Math.abs(e)-Math.abs(a);n<0&&(e=(1-Math.abs(a))*(e>=0?1:-1),a=(1-Math.abs(e))*(a>=0?1:-1));const i=Math.sqrt(e*e+a*a+n*n);return[e/i,a/i,n/i]}function dot(t,e,a){return t[e]*a[0]+t[e+1]*a[1]+t[e+2]*a[2]}const geometryCompression={quantizePositions:quantizePositions,createPositionsDecodeMatrix:createPositionsDecodeMatrix,transformAndOctEncodeNormals:transformAndOctEncodeNormals,octEncodeNormals:octEncodeNormals},buildEdgeIndices=function(){const t=[],e=[],a=[],n=[],i=[];let r=0;const s=new Uint16Array(3),o=new Uint16Array(3),l=new Uint16Array(3),h=math.vec3(),c=math.vec3(),d=math.vec3(),u=math.vec3(),m=math.vec3(),f=math.vec3(),p=math.vec3();return function(_,g,w,b){!function(i,r){const s={};let o,l,h,c;const d=Math.pow(10,4);let u,m,f=0;for(u=0,m=i.length;u<m;u+=3)o=i[u],l=i[u+1],h=i[u+2],void 0===s[c=Math.round(o*d)+"_"+Math.round(l*d)+"_"+Math.round(h*d)]&&(s[c]=f/3,t[f++]=o,t[f++]=l,t[f++]=h),e[u/3]=s[c];for(u=0,m=r.length;u<m;u++)n[u]=e[r[u]],a[n[u]]=r[u]}(_,g),function(e,a){r=0;for(let _=0,g=e;_<g;_+=3){const e=3*n[_],g=3*n[_+1],w=3*n[_+2];a?(s[0]=t[e],s[1]=t[e+1],s[2]=t[e+2],o[0]=t[g],o[1]=t[g+1],o[2]=t[g+2],l[0]=t[w],l[1]=t[w+1],l[2]=t[w+2],math.decompressPosition(s,a,h),math.decompressPosition(o,a,c),math.decompressPosition(l,a,d)):(h[0]=t[e],h[1]=t[e+1],h[2]=t[e+2],c[0]=t[g],c[1]=t[g+1],c[2]=t[g+2],d[0]=t[w],d[1]=t[w+1],d[2]=t[w+2]),math.subVec3(d,c,u),math.subVec3(h,c,m),math.cross3Vec3(u,m,f),math.normalizeVec3(f,p);const b=i[r]||(i[r]={normal:math.vec3()});b.normal[0]=p[0],b.normal[1]=p[1],b.normal[2]=p[2],r++}}(g.length,w);const y=[],v=Math.cos(math.DEGTORAD*b),M={};let A,k,x,T,B,z,E,I,O,S,V,D=!1;for(let t=0,e=g.length;t<e;t+=3){const e=t/3;for(let a=0;a<3;a++)A=n[t+a],k=n[t+(a+1)%3],void 0===M[B=(x=Math.min(A,k))+","+(T=Math.max(A,k))]?M[B]={index1:x,index2:T,face1:e,face2:void 0}:M[B].face2=e}for(B in M)void 0!==(z=M[B]).face2&&(E=i[z.face1].normal,I=i[z.face2].normal,(O=math.dotVec3(E,I))>v)||(S=a[z.index1],V=a[z.index2],(!D&&S>65535||V>65535)&&(D=!0),y.push(S),y.push(V));return D?new Uint32Array(y):new Uint16Array(y)}}(),isTriangleMeshSolid=(t,e)=>{let a=0;const n={},i=[],r={};for(let r=0,s=t.length;r<s;r++){const s=t[r],o=e[3*s]+","+e[3*s+1]+","+e[3*s+2];let l=n[o];void 0===l&&(l=a++),i[r]=l,n[o]=l}for(let t=0,e=i.length;t<e;t+=3){const e=i[t],a=i[t+1],n=i[t+2];let s=e,o=a,l=n;e>a&&e>n?a>n?(s=e,o=a,l=n):(s=e,o=n,l=a):a>e&&a>n?e>n?(s=a,o=e,l=n):(s=a,o=n,l=e):n>e&&n>a&&(e>a?(s=n,o=e,l=a):(s=n,o=a,l=e));let h=s+"-"+o,c=r[h];if(r[h]=void 0===c?1:c+1,c=r[h=o+"-"+l],r[h]=void 0===c?1:c+1,s>l){const t=l;l=s,s=t}c=r[h=l+"-"+s],r[h]=void 0===c?1:c+1}for(let t in r)if(2!==r[t])return!1;return!0};class XKTMesh{constructor(t){this.meshId=t.meshId,this.meshIndex=t.meshIndex,this.matrix=t.matrix,this.geometry=t.geometry,this.color=t.color||new Uint8Array(3),this.metallic=null!==t.metallic&&void 0!==t.metallic?t.metallic:0,this.roughness=null!==t.roughness&&void 0!==t.roughness?t.roughness:1,this.opacity=void 0!==t.opacity&&null!==t.opacity?t.opacity:1,this.entity=null}}class XKTGeometry{constructor(t){this.geometryId=t.geometryId,this.primitiveType=t.primitiveType,this.geometryIndex=t.geometryIndex,this.numInstances=0,this.positions=t.positions,this.positionsQuantized=new Uint16Array(t.positions.length),this.normals=t.normals,this.normalsOctEncoded=null,this.colorsCompressed=t.colorsCompressed,this.indices=t.indices,this.edgeIndices=t.edgeIndices,this.solid=!1}get reused(){return this.numInstances>1}}class XKTEntity{constructor(t,e){this.entityId=t,this.entityIndex=null,this.meshes=e,this.aabb=math.AABB3(),this.hasReusedGeometries=!1}}class XKTTile{constructor(t,e){this.aabb=t,this.entities=e}}class KDNode{constructor(t){this.aabb=t,this.entities=null,this.left=null,this.right=null}}class XKTMetaObject{constructor(t,e,a,n,i){this.metaObjectId=t,this.metaObjectType=e,this.metaObjectName=a,this.metaObjectIndex=n,this.parentMetaObjectId=i}}const tempVec4a=math.vec4([0,0,0,1]),tempVec4b=math.vec4([0,0,0,1]),tempMat4=math.mat4(),tempMat4b=math.mat4(),MIN_TILE_DIAG=1e4,kdTreeDimLength=new Float64Array(3);class XKTModel{constructor(t={}){this.edgeThreshold=t.edgeThreshold||10,this.metaObjects={},this.metaObjectsList=[],this.reusedGeometriesDecodeMatrix=new Float32Array(16),this.geometries={},this.geometriesList=[],this.meshes={},this.meshesList=[],this.entities={},this.entitiesList=[],this.tilesList=[],this.finalized=!1}createMetaObject(t){if(!t)throw"Parameters expected: params";if(null===t.metaObjectId||void 0===t.metaObjectId)throw"Parameter expected: params.metaObjectId";if(this.finalized)return void console.error("XKTModel has been finalized, can't add more meta objects");if(this.metaObjects[t.metaObjectId])return;const e=t.metaObjectId,a=t.metaObjectType||"default",n=t.metaObjectName||t.metaObjectId,i=this.metaObjectsList.length,r=null!==t.parentMetaObjectId&&void 0!==t.parentMetaObjectId?t.parentMetaObjectId:t.metaObjectId,s=new XKTMetaObject(e,a,n,i,r);return this.metaObjects[e]=s,this.metaObjectsList.push(s),s}createGeometry(t){if(!t)throw"Parameters expected: params";if(null===t.geometryId||void 0===t.geometryId)throw"Parameter expected: params.geometryId";if(!t.primitiveType)throw"Parameter expected: params.primitiveType";if(!t.positions)throw"Parameter expected: params.positions";const e="triangles"===t.primitiveType,a="points"===t.primitiveType,n="lines"===t.primitiveType;if(!e&&!a&&!n)throw"Unsupported value for params.primitiveType: "+t.primitiveType+"' - supported values are 'triangles', 'points' and 'lines'";if(e){if(!t.normals)throw"Parameter expected for 'triangles' primitive: params.normals";if(!t.indices)throw"Parameter expected for 'triangles' primitive: params.indices"}if(a&&!t.colors&&!t.colorsCompressed)throw"Parameter expected for 'points' primitive: params.colors or params.colorsCompressed";if(n&&!t.indices)throw"Parameter expected for 'lines' primitive: params.indices";if(this.finalized)return void console.error("XKTModel has been finalized, can't add more geometries");if(this.geometries[t.geometryId])return void console.error("XKTGeometry already exists with this ID: "+t.geometryId);const i=t.geometryId,r=t.primitiveType,s=new Float64Array(t.positions),o={geometryId:i,geometryIndex:this.geometriesList.length,primitiveType:r,positions:s};if(e&&(o.normals=new Float64Array(t.normals),o.indices=t.indices,o.edgeIndices=buildEdgeIndices(s,t.indices,null,t.edgeThreshold||this.edgeThreshold||10)),a)if(t.colorsCompressed)o.colorsCompressed=new Uint8Array(t.colorsCompressed);else{const e=t.colors,a=new Uint8Array(e.length);for(let t=0,n=e.length;t<n;t++)a[t]=Math.floor(255*e[t]);o.colorsCompressed=a}n&&(o.indices=t.indices);const l=new XKTGeometry(o);return this.geometries[i]=l,this.geometriesList.push(l),l}createMesh(t){if(null===t.meshId||void 0===t.meshId)throw"Parameter expected: params.meshId";if(null===t.geometryId||void 0===t.geometryId)throw"Parameter expected: params.geometryId";if(this.finalized)throw"XKTModel has been finalized, can't add more meshes";if(this.meshes[t.meshId])return void console.error("XKTMesh already exists with this ID: "+t.meshId);const e=this.geometries[t.geometryId];if(!e)return void console.error("XKTGeometry not found: "+t.geometryId);e.numInstances++;let a=t.matrix;if(!a){const e=t.position,n=t.scale,i=t.rotation;if(e||n||i){a=math.identityMat4();const t=math.eulerToQuaternion(i||[0,0,0],"XYZ",math.identityQuaternion());math.composeMat4(e||[0,0,0],t,n||[1,1,1],a)}else a=math.identityMat4()}const n=this.meshesList.length,i=new XKTMesh({meshId:t.meshId,meshIndex:n,matrix:a,geometry:e,color:t.color,metallic:t.metallic,roughness:t.roughness,opacity:t.opacity});return this.meshes[i.meshId]=i,this.meshesList.push(i),i}createEntity(t){if(!t)throw"Parameters expected: params";if(null===t.entityId||void 0===t.entityId)throw"Parameter expected: params.entityId";if(!t.meshIds)throw"Parameter expected: params.meshIds";if(this.finalized)return void console.error("XKTModel has been finalized, can't add more entities");if(this.entities[t.entityId])return void console.error("XKTEntity already exists with this ID: "+t.entityId);const e=t.entityId,a=t.meshIds,n=[];for(let t=0,e=a.length;t<e;t++){const e=a[t],i=this.meshes[e];i?i.entity?console.error("XKTMesh "+e+" already used by XKTEntity "+i.entity.entityId):n.push(i):console.error("XKTMesh found: "+e)}const i=new XKTEntity(e,n);for(let t=0,e=n.length;t<e;t++){n[t].entity=i}return this.entities[e]=i,this.entitiesList.push(i),i}finalize(){if(this.finalized)return void console.log("XKTModel already finalized");this._bakeSingleUseGeometryPositions(),this._bakeAndOctEncodeNormals(),this._createEntityAABBs();const t=this._createKDTree();this.entitiesList=[],this._createTilesFromKDTree(t),this._createReusedGeometriesDecodeMatrix(),this._flagSolidGeometries(),this._createDefaultMetaObjects(),this.finalized=!0}_bakeSingleUseGeometryPositions(){for(let t=0,e=this.meshesList.length;t<e;t++){const e=this.meshesList[t],a=e.geometry;if(1===a.numInstances){const t=e.matrix;if(t&&!math.isIdentityMat4(t)){const e=a.positions;for(let a=0,n=e.length;a<n;a+=3)tempVec4a[0]=e[a+0],tempVec4a[1]=e[a+1],tempVec4a[2]=e[a+2],tempVec4a[3]=1,math.transformPoint4(t,tempVec4a,tempVec4b),e[a+0]=tempVec4b[0],e[a+1]=tempVec4b[1],e[a+2]=tempVec4b[2]}}}}_bakeAndOctEncodeNormals(){for(let t=0,e=this.meshesList.length;t<e;t++){const e=this.meshesList[t],a=e.geometry;if(a.normals&&!a.normalsOctEncoded)if(a.normalsOctEncoded=new Int8Array(a.normals.length),a.numInstances>1)geometryCompression.octEncodeNormals(a.normals,a.normals.length,a.normalsOctEncoded,0);else{const t=math.inverseMat4(math.transposeMat4(e.matrix,tempMat4),tempMat4b);geometryCompression.transformAndOctEncodeNormals(t,a.normals,a.normals.length,a.normalsOctEncoded,0)}}}_createEntityAABBs(){for(let t=0,e=this.entitiesList.length;t<e;t++){const e=this.entitiesList[t],a=e.aabb,n=e.meshes;math.collapseAABB3(a);for(let t=0,e=n.length;t<e;t++){const e=n[t],i=e.geometry,r=e.matrix;if(i.numInstances>1){const t=i.positions;for(let e=0,n=t.length;e<n;e+=3)tempVec4a[0]=t[e+0],tempVec4a[1]=t[e+1],tempVec4a[2]=t[e+2],tempVec4a[3]=1,math.transformPoint4(r,tempVec4a,tempVec4b),math.expandAABB3Point3(a,tempVec4b)}else{const t=i.positions;for(let e=0,n=t.length;e<n;e+=3)tempVec4a[0]=t[e+0],tempVec4a[1]=t[e+1],tempVec4a[2]=t[e+2],math.expandAABB3Point3(a,tempVec4a)}}}}_createKDTree(){const t=math.collapseAABB3();for(let e=0,a=this.entitiesList.length;e<a;e++){const a=this.entitiesList[e];math.expandAABB3(t,a.aabb)}const e=new KDNode(t);for(let t=0,a=this.entitiesList.length;t<a;t++){const a=this.entitiesList[t];this._insertEntityIntoKDTree(e,a)}return e}_insertEntityIntoKDTree(t,e){const a=t.aabb,n=e.aabb;if(math.getAABB3Diag(a)<MIN_TILE_DIAG)return t.entities=t.entities||[],t.entities.push(e),void math.expandAABB3(a,n);if(t.left&&math.containsAABB3(t.left.aabb,n))return void this._insertEntityIntoKDTree(t.left,e);if(t.right&&math.containsAABB3(t.right.aabb,n))return void this._insertEntityIntoKDTree(t.right,e);kdTreeDimLength[0]=a[3]-a[0],kdTreeDimLength[1]=a[4]-a[1],kdTreeDimLength[2]=a[5]-a[2];let i=0;if(kdTreeDimLength[1]>kdTreeDimLength[i]&&(i=1),kdTreeDimLength[2]>kdTreeDimLength[i]&&(i=2),!t.left){const r=a.slice();if(r[i+3]=(a[i]+a[i+3])/2,t.left=new KDNode(r),math.containsAABB3(r,n))return void this._insertEntityIntoKDTree(t.left,e)}if(!t.right){const r=a.slice();if(r[i]=(a[i]+a[i+3])/2,t.right=new KDNode(r),math.containsAABB3(r,n))return void this._insertEntityIntoKDTree(t.right,e)}t.entities=t.entities||[],t.entities.push(e),math.expandAABB3(a,n)}_createTilesFromKDTree(t){this._createTilesFromKDNode(t)}_createTilesFromKDNode(t){t.entities&&t.entities.length>0&&this._createTileFromEntities(t.entities),t.left&&this._createTilesFromKDNode(t.left),t.right&&this._createTilesFromKDNode(t.right)}_createTileFromEntities(t){const e=math.AABB3();math.collapseAABB3(e);for(let a=0;a<t.length;a++){const n=t[a];math.expandAABB3(e,n.aabb)}const a=math.getAABB3Center(e),n=math.mulVec3Scalar(a,-1,math.vec3()),i=math.AABB3();i[0]=e[0]-a[0],i[1]=e[1]-a[1],i[2]=e[2]-a[2],i[3]=e[3]-a[0],i[4]=e[4]-a[1],i[5]=e[5]-a[2];for(let e=0;e<t.length;e++){const r=t[e],s=r.meshes;for(let t=0,e=s.length;t<e;t++){const e=s[t],r=e.geometry;if(r.reused)math.translateMat4v(n,e.matrix);else{const t=r.positions;for(let e=0,n=t.length;e<n;e+=3)t[e+0]-=a[0],t[e+1]-=a[1],t[e+2]-=a[2];geometryCompression.quantizePositions(t,t.length,i,r.positionsQuantized)}}r.entityIndex=this.entitiesList.length,this.entitiesList.push(r)}const r=new XKTTile(e,t);this.tilesList.push(r)}_createReusedGeometriesDecodeMatrix(){const t=math.vec3(),e=math.collapseAABB3(math.AABB3());let a=0;for(let n=0,i=this.geometriesList.length;n<i;n++){const i=this.geometriesList[n];if(i.reused){const n=i.positions;for(let a=0,i=n.length;a<i;a+=3)t[0]=n[a],t[1]=n[a+1],t[2]=n[a+2],math.expandAABB3Point3(e,t);a++}}if(a>0){geometryCompression.createPositionsDecodeMatrix(e,this.reusedGeometriesDecodeMatrix);for(let t=0,a=this.geometriesList.length;t<a;t++){const a=this.geometriesList[t];a.reused&&geometryCompression.quantizePositions(a.positions,a.positions.length,e,a.positionsQuantized)}}else math.identityMat4(this.reusedGeometriesDecodeMatrix)}_flagSolidGeometries(){for(let t=0,e=this.geometriesList.length;t<e;t++){const e=this.geometriesList[t];"triangles"===e.primitiveType&&(e.solid=isTriangleMeshSolid(e.indices,e.positionsQuantized))}}_createDefaultMetaObjects(){for(let t=0,e=this.entitiesList.length;t<e;t++){const e=this.entitiesList[t].entityId;this.metaObjects[e]||this.createMetaObject({metaObjectId:e,metaObjectType:"default",metaObjectName:""+e,parentMetaObjectId:e})}}}function createCommonjsModule(t,e,a){return t(a={path:e,exports:{},require:function(t,e){return commonjsRequire(t,void 0===e||null===e?a.path:e)}},a.exports),a.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var pako=createCommonjsModule(function(t,e){t.exports=function t(e,a,n){function i(s,o){if(!a[s]){if(!e[s]){var l="function"==typeof commonjsRequire&&commonjsRequire;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=a[s]={exports:{}};e[s][0].call(c.exports,function(t){var a=e[s][1][t];return i(a||t)},c,c.exports,t,e,a,n)}return a[s].exports}for(var r="function"==typeof commonjsRequire&&commonjsRequire,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,e,a){var n=t("./zlib/deflate"),i=t("./utils/common"),r=t("./utils/strings"),s=t("./zlib/messages"),o=t("./zlib/zstream"),l=Object.prototype.toString,h=0,c=-1,d=0,u=8;function m(t){if(!(this instanceof m))return new m(t);this.options=i.assign({level:c,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var a=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(a!==h)throw new Error(s[a]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var f;if(f="string"==typeof e.dictionary?r.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(a=n.deflateSetDictionary(this.strm,f))!==h)throw new Error(s[a]);this._dict_set=!0}}function f(t,e){var a=new m(e);if(a.push(t,!0),a.err)throw a.msg||s[a.err];return a.result}m.prototype.push=function(t,e){var a,s,o=this.strm,c=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=r.string2buf(t):"[object ArrayBuffer]"===l.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new i.Buf8(c),o.next_out=0,o.avail_out=c),1!==(a=n.deflate(o,s))&&a!==h)return this.onEnd(a),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(r.buf2binstring(i.shrinkBuf(o.output,o.next_out))):this.onData(i.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==a);return 4===s?(a=n.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===h):2!==s||(this.onEnd(h),o.avail_out=0,!0)},m.prototype.onData=function(t){this.chunks.push(t)},m.prototype.onEnd=function(t){t===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},a.Deflate=m,a.deflate=f,a.deflateRaw=function(t,e){return(e=e||{}).raw=!0,f(t,e)},a.gzip=function(t,e){return(e=e||{}).gzip=!0,f(t,e)}},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(t,e,a){var n=t("./zlib/inflate"),i=t("./utils/common"),r=t("./utils/strings"),s=t("./zlib/constants"),o=t("./zlib/messages"),l=t("./zlib/zstream"),h=t("./zlib/gzheader"),c=Object.prototype.toString;function d(t){if(!(this instanceof d))return new d(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var a=n.inflateInit2(this.strm,e.windowBits);if(a!==s.Z_OK)throw new Error(o[a]);if(this.header=new h,n.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=r.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(a=n.inflateSetDictionary(this.strm,e.dictionary))!==s.Z_OK))throw new Error(o[a])}function u(t,e){var a=new d(e);if(a.push(t,!0),a.err)throw a.msg||o[a.err];return a.result}d.prototype.push=function(t,e){var a,o,l,h,d,u=this.strm,m=this.options.chunkSize,f=this.options.dictionary,p=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof t?u.input=r.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?u.input=new Uint8Array(t):u.input=t,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new i.Buf8(m),u.next_out=0,u.avail_out=m),(a=n.inflate(u,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&f&&(a=n.inflateSetDictionary(this.strm,f)),a===s.Z_BUF_ERROR&&!0===p&&(a=s.Z_OK,p=!1),a!==s.Z_STREAM_END&&a!==s.Z_OK)return this.onEnd(a),this.ended=!0,!1;u.next_out&&(0!==u.avail_out&&a!==s.Z_STREAM_END&&(0!==u.avail_in||o!==s.Z_FINISH&&o!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(l=r.utf8border(u.output,u.next_out),h=u.next_out-l,d=r.buf2string(u.output,l),u.next_out=h,u.avail_out=m-h,h&&i.arraySet(u.output,u.output,l,h,0),this.onData(d)):this.onData(i.shrinkBuf(u.output,u.next_out)))),0===u.avail_in&&0===u.avail_out&&(p=!0)}while((u.avail_in>0||0===u.avail_out)&&a!==s.Z_STREAM_END);return a===s.Z_STREAM_END&&(o=s.Z_FINISH),o===s.Z_FINISH?(a=n.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===s.Z_OK):o!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),u.avail_out=0,!0)},d.prototype.onData=function(t){this.chunks.push(t)},d.prototype.onEnd=function(t){t===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},a.Inflate=d,a.inflate=u,a.inflateRaw=function(t,e){return(e=e||{}).raw=!0,u(t,e)},a.ungzip=u},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(t,e,a){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}a.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var a=e.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(var n in a)i(a,n)&&(t[n]=a[n])}}return t},a.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,a,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(a,a+n),i);else for(var r=0;r<n;r++)t[i+r]=e[a+r]},flattenChunks:function(t){var e,a,n,i,r,s;for(n=0,e=0,a=t.length;e<a;e++)n+=t[e].length;for(s=new Uint8Array(n),i=0,e=0,a=t.length;e<a;e++)r=t[e],s.set(r,i),i+=r.length;return s}},s={arraySet:function(t,e,a,n,i){for(var r=0;r<n;r++)t[i+r]=e[a+r]},flattenChunks:function(t){return[].concat.apply([],t)}};a.setTyped=function(t){t?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,r)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,s))},a.setTyped(n)},{}],4:[function(t,e,a){var n=t("./common"),i=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){r=!1}for(var s=new n.Buf8(256),o=0;o<256;o++)s[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function l(t,e){if(e<65534&&(t.subarray&&r||!t.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var a="",s=0;s<e;s++)a+=String.fromCharCode(t[s]);return a}s[254]=s[254]=1,a.string2buf=function(t){var e,a,i,r,s,o=t.length,l=0;for(r=0;r<o;r++)55296==(64512&(a=t.charCodeAt(r)))&&r+1<o&&56320==(64512&(i=t.charCodeAt(r+1)))&&(a=65536+(a-55296<<10)+(i-56320),r++),l+=a<128?1:a<2048?2:a<65536?3:4;for(e=new n.Buf8(l),s=0,r=0;s<l;r++)55296==(64512&(a=t.charCodeAt(r)))&&r+1<o&&56320==(64512&(i=t.charCodeAt(r+1)))&&(a=65536+(a-55296<<10)+(i-56320),r++),a<128?e[s++]=a:a<2048?(e[s++]=192|a>>>6,e[s++]=128|63&a):a<65536?(e[s++]=224|a>>>12,e[s++]=128|a>>>6&63,e[s++]=128|63&a):(e[s++]=240|a>>>18,e[s++]=128|a>>>12&63,e[s++]=128|a>>>6&63,e[s++]=128|63&a);return e},a.buf2binstring=function(t){return l(t,t.length)},a.binstring2buf=function(t){for(var e=new n.Buf8(t.length),a=0,i=e.length;a<i;a++)e[a]=t.charCodeAt(a);return e},a.buf2string=function(t,e){var a,n,i,r,o=e||t.length,h=new Array(2*o);for(n=0,a=0;a<o;)if((i=t[a++])<128)h[n++]=i;else if((r=s[i])>4)h[n++]=65533,a+=r-1;else{for(i&=2===r?31:3===r?15:7;r>1&&a<o;)i=i<<6|63&t[a++],r--;r>1?h[n++]=65533:i<65536?h[n++]=i:(i-=65536,h[n++]=55296|i>>10&1023,h[n++]=56320|1023&i)}return l(h,n)},a.utf8border=function(t,e){var a;for((e=e||t.length)>t.length&&(e=t.length),a=e-1;a>=0&&128==(192&t[a]);)a--;return a<0?e:0===a?e:a+s[t[a]]>e?a:e}},{"./common":3}],5:[function(t,e,a){e.exports=function(t,e,a,n){for(var i=65535&t|0,r=t>>>16&65535|0,s=0;0!==a;){a-=s=a>2e3?2e3:a;do{i=i+e[n++]|0,r=r+i|0}while(--s);i%=65521,r%=65521}return i|r<<16|0}},{}],6:[function(t,e,a){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(t,e,a){var n=function(){for(var t,e=[],a=0;a<256;a++){t=a;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[a]=t}return e}();e.exports=function(t,e,a,i){var r=n,s=i+a;t^=-1;for(var o=i;o<s;o++)t=t>>>8^r[255&(t^e[o])];return-1^t}},{}],8:[function(t,e,a){var n,i=t("../utils/common"),r=t("./trees"),s=t("./adler32"),o=t("./crc32"),l=t("./messages"),h=0,c=1,d=3,u=4,m=5,f=0,p=1,_=-2,g=-3,w=-5,b=-1,y=1,v=2,M=3,A=4,k=0,x=2,T=8,B=9,z=15,E=8,I=286,O=30,S=19,V=2*I+1,D=15,P=3,L=258,G=L+P+1,j=32,F=42,U=69,N=73,C=91,X=103,K=113,R=666,Z=1,q=2,$=3,Q=4,Y=3;function H(t,e){return t.msg=l[e],e}function W(t){return(t<<1)-(t>4?9:0)}function J(t){for(var e=t.length;--e>=0;)t[e]=0}function tt(t){var e=t.state,a=e.pending;a>t.avail_out&&(a=t.avail_out),0!==a&&(i.arraySet(t.output,e.pending_buf,e.pending_out,a,t.next_out),t.next_out+=a,e.pending_out+=a,t.total_out+=a,t.avail_out-=a,e.pending-=a,0===e.pending&&(e.pending_out=0))}function et(t,e){r._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,tt(t.strm)}function at(t,e){t.pending_buf[t.pending++]=e}function nt(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function it(t,e){var a,n,i=t.max_chain_length,r=t.strstart,s=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-G?t.strstart-(t.w_size-G):0,h=t.window,c=t.w_mask,d=t.prev,u=t.strstart+L,m=h[r+s-1],f=h[r+s];t.prev_length>=t.good_match&&(i>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(a=e)+s]===f&&h[a+s-1]===m&&h[a]===h[r]&&h[++a]===h[r+1]){r+=2,a++;do{}while(h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&r<u);if(n=L-(u-r),r=u-L,n>s){if(t.match_start=e,s=n,n>=o)break;m=h[r+s-1],f=h[r+s]}}}while((e=d[e&c])>l&&0!=--i);return s<=t.lookahead?s:t.lookahead}function rt(t){var e,a,n,r,l,h,c,d,u,m,f=t.w_size;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=f+(f-G)){i.arraySet(t.window,t.window,f,f,0),t.match_start-=f,t.strstart-=f,t.block_start-=f,a=t.hash_size,e=a;do{n=t.head[--e],t.head[e]=n>=f?n-f:0}while(--a);e=a=f;do{n=t.prev[--e],t.prev[e]=n>=f?n-f:0}while(--a);r+=f}if(0===t.strm.avail_in)break;if(h=t.strm,c=t.window,d=t.strstart+t.lookahead,u=r,m=void 0,(m=h.avail_in)>u&&(m=u),a=0===m?0:(h.avail_in-=m,i.arraySet(c,h.input,h.next_in,m,d),1===h.state.wrap?h.adler=s(h.adler,c,m,d):2===h.state.wrap&&(h.adler=o(h.adler,c,m,d)),h.next_in+=m,h.total_in+=m,m),t.lookahead+=a,t.lookahead+t.insert>=P)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+P-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<P)););}while(t.lookahead<G&&0!==t.strm.avail_in)}function st(t,e){for(var a,n;;){if(t.lookahead<G){if(rt(t),t.lookahead<G&&e===h)return Z;if(0===t.lookahead)break}if(a=0,t.lookahead>=P&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+P-1])&t.hash_mask,a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==a&&t.strstart-a<=t.w_size-G&&(t.match_length=it(t,a)),t.match_length>=P)if(n=r._tr_tally(t,t.strstart-t.match_start,t.match_length-P),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=P){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+P-1])&t.hash_mask,a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=r._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(et(t,!1),0===t.strm.avail_out))return Z}return t.insert=t.strstart<P-1?t.strstart:P-1,e===u?(et(t,!0),0===t.strm.avail_out?$:Q):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?Z:q}function ot(t,e){for(var a,n,i;;){if(t.lookahead<G){if(rt(t),t.lookahead<G&&e===h)return Z;if(0===t.lookahead)break}if(a=0,t.lookahead>=P&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+P-1])&t.hash_mask,a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=P-1,0!==a&&t.prev_length<t.max_lazy_match&&t.strstart-a<=t.w_size-G&&(t.match_length=it(t,a),t.match_length<=5&&(t.strategy===y||t.match_length===P&&t.strstart-t.match_start>4096)&&(t.match_length=P-1)),t.prev_length>=P&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-P,n=r._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-P),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+P-1])&t.hash_mask,a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=P-1,t.strstart++,n&&(et(t,!1),0===t.strm.avail_out))return Z}else if(t.match_available){if((n=r._tr_tally(t,0,t.window[t.strstart-1]))&&et(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return Z}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=r._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<P-1?t.strstart:P-1,e===u?(et(t,!0),0===t.strm.avail_out?$:Q):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?Z:q}function lt(t,e,a,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=a,this.max_chain=n,this.func=i}function ht(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=x,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?F:K,t.adler=2===e.wrap?0:1,e.last_flush=h,r._tr_init(e),f):H(t,_)}function ct(t){var e,a=ht(t);return a===f&&((e=t.state).window_size=2*e.w_size,J(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=P-1,e.match_available=0,e.ins_h=0),a}function dt(t,e,a,n,r,s){if(!t)return _;var o=1;if(e===b&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),r<1||r>B||a!==T||n<8||n>15||e<0||e>9||s<0||s>A)return H(t,_);8===n&&(n=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*V),this.dyn_dtree=new i.Buf16(2*(2*O+1)),this.bl_tree=new i.Buf16(2*(2*S+1)),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(D+1),this.heap=new i.Buf16(2*I+1),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*I+1),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return t.state=l,l.strm=t,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+P-1)/P),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=s,l.method=a,ct(t)}n=[new lt(0,0,0,0,function(t,e){var a=65535;for(a>t.pending_buf_size-5&&(a=t.pending_buf_size-5);;){if(t.lookahead<=1){if(rt(t),0===t.lookahead&&e===h)return Z;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+a;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,et(t,!1),0===t.strm.avail_out))return Z;if(t.strstart-t.block_start>=t.w_size-G&&(et(t,!1),0===t.strm.avail_out))return Z}return t.insert=0,e===u?(et(t,!0),0===t.strm.avail_out?$:Q):(t.strstart>t.block_start&&(et(t,!1),t.strm.avail_out),Z)}),new lt(4,4,8,4,st),new lt(4,5,16,8,st),new lt(4,6,32,32,st),new lt(4,4,16,16,ot),new lt(8,16,32,32,ot),new lt(8,16,128,128,ot),new lt(8,32,128,256,ot),new lt(32,128,258,1024,ot),new lt(32,258,258,4096,ot)],a.deflateInit=function(t,e){return dt(t,e,T,z,E,k)},a.deflateInit2=dt,a.deflateReset=ct,a.deflateResetKeep=ht,a.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?_:(t.state.gzhead=e,f):_},a.deflate=function(t,e){var a,i,s,l;if(!t||!t.state||e>m||e<0)return t?H(t,_):_;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===R&&e!==u)return H(t,0===t.avail_out?w:_);if(i.strm=t,a=i.last_flush,i.last_flush=e,i.status===F)if(2===i.wrap)t.adler=0,at(i,31),at(i,139),at(i,8),i.gzhead?(at(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),at(i,255&i.gzhead.time),at(i,i.gzhead.time>>8&255),at(i,i.gzhead.time>>16&255),at(i,i.gzhead.time>>24&255),at(i,9===i.level?2:i.strategy>=v||i.level<2?4:0),at(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(at(i,255&i.gzhead.extra.length),at(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=o(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=U):(at(i,0),at(i,0),at(i,0),at(i,0),at(i,0),at(i,9===i.level?2:i.strategy>=v||i.level<2?4:0),at(i,Y),i.status=K);else{var g=T+(i.w_bits-8<<4)<<8,b=-1;b=i.strategy>=v||i.level<2?0:i.level<6?1:6===i.level?2:3,g|=b<<6,0!==i.strstart&&(g|=j),g+=31-g%31,i.status=K,nt(i,g),0!==i.strstart&&(nt(i,t.adler>>>16),nt(i,65535&t.adler)),t.adler=1}if(i.status===U)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(t.adler=o(t.adler,i.pending_buf,i.pending-s,s)),tt(t),s=i.pending,i.pending!==i.pending_buf_size));)at(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(t.adler=o(t.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=N)}else i.status=N;if(i.status===N)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(t.adler=o(t.adler,i.pending_buf,i.pending-s,s)),tt(t),s=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,at(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>s&&(t.adler=o(t.adler,i.pending_buf,i.pending-s,s)),0===l&&(i.gzindex=0,i.status=C)}else i.status=C;if(i.status===C)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(t.adler=o(t.adler,i.pending_buf,i.pending-s,s)),tt(t),s=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,at(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>s&&(t.adler=o(t.adler,i.pending_buf,i.pending-s,s)),0===l&&(i.status=X)}else i.status=X;if(i.status===X&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&tt(t),i.pending+2<=i.pending_buf_size&&(at(i,255&t.adler),at(i,t.adler>>8&255),t.adler=0,i.status=K)):i.status=K),0!==i.pending){if(tt(t),0===t.avail_out)return i.last_flush=-1,f}else if(0===t.avail_in&&W(e)<=W(a)&&e!==u)return H(t,w);if(i.status===R&&0!==t.avail_in)return H(t,w);if(0!==t.avail_in||0!==i.lookahead||e!==h&&i.status!==R){var y=i.strategy===v?function(t,e){for(var a;;){if(0===t.lookahead&&(rt(t),0===t.lookahead)){if(e===h)return Z;break}if(t.match_length=0,a=r._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,a&&(et(t,!1),0===t.strm.avail_out))return Z}return t.insert=0,e===u?(et(t,!0),0===t.strm.avail_out?$:Q):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?Z:q}(i,e):i.strategy===M?function(t,e){for(var a,n,i,s,o=t.window;;){if(t.lookahead<=L){if(rt(t),t.lookahead<=L&&e===h)return Z;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=P&&t.strstart>0&&(i=t.strstart-1,(n=o[i])===o[++i]&&n===o[++i]&&n===o[++i])){s=t.strstart+L;do{}while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&i<s);t.match_length=L-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=P?(a=r._tr_tally(t,1,t.match_length-P),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(a=r._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),a&&(et(t,!1),0===t.strm.avail_out))return Z}return t.insert=0,e===u?(et(t,!0),0===t.strm.avail_out?$:Q):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?Z:q}(i,e):n[i.level].func(i,e);if(y!==$&&y!==Q||(i.status=R),y===Z||y===$)return 0===t.avail_out&&(i.last_flush=-1),f;if(y===q&&(e===c?r._tr_align(i):e!==m&&(r._tr_stored_block(i,0,0,!1),e===d&&(J(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),tt(t),0===t.avail_out))return i.last_flush=-1,f}return e!==u?f:i.wrap<=0?p:(2===i.wrap?(at(i,255&t.adler),at(i,t.adler>>8&255),at(i,t.adler>>16&255),at(i,t.adler>>24&255),at(i,255&t.total_in),at(i,t.total_in>>8&255),at(i,t.total_in>>16&255),at(i,t.total_in>>24&255)):(nt(i,t.adler>>>16),nt(i,65535&t.adler)),tt(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?f:p)},a.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==F&&e!==U&&e!==N&&e!==C&&e!==X&&e!==K&&e!==R?H(t,_):(t.state=null,e===K?H(t,g):f):_},a.deflateSetDictionary=function(t,e){var a,n,r,o,l,h,c,d,u=e.length;if(!t||!t.state)return _;if(a=t.state,2===(o=a.wrap)||1===o&&a.status!==F||a.lookahead)return _;for(1===o&&(t.adler=s(t.adler,e,u,0)),a.wrap=0,u>=a.w_size&&(0===o&&(J(a.head),a.strstart=0,a.block_start=0,a.insert=0),d=new i.Buf8(a.w_size),i.arraySet(d,e,u-a.w_size,a.w_size,0),e=d,u=a.w_size),l=t.avail_in,h=t.next_in,c=t.input,t.avail_in=u,t.next_in=0,t.input=e,rt(a);a.lookahead>=P;){n=a.strstart,r=a.lookahead-(P-1);do{a.ins_h=(a.ins_h<<a.hash_shift^a.window[n+P-1])&a.hash_mask,a.prev[n&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=n,n++}while(--r);a.strstart=n,a.lookahead=P-1,rt(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=P-1,a.match_available=0,t.next_in=h,t.input=c,t.avail_in=l,a.wrap=o,f},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(t,e,a){e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],10:[function(t,e,a){e.exports=function(t,e){var a,n,i,r,s,o,l,h,c,d,u,m,f,p,_,g,w,b,y,v,M,A,k,x,T;a=t.state,n=t.next_in,x=t.input,i=n+(t.avail_in-5),r=t.next_out,T=t.output,s=r-(e-t.avail_out),o=r+(t.avail_out-257),l=a.dmax,h=a.wsize,c=a.whave,d=a.wnext,u=a.window,m=a.hold,f=a.bits,p=a.lencode,_=a.distcode,g=(1<<a.lenbits)-1,w=(1<<a.distbits)-1;t:do{f<15&&(m+=x[n++]<<f,f+=8,m+=x[n++]<<f,f+=8),b=p[m&g];e:for(;;){if(m>>>=y=b>>>24,f-=y,0==(y=b>>>16&255))T[r++]=65535&b;else{if(!(16&y)){if(0==(64&y)){b=p[(65535&b)+(m&(1<<y)-1)];continue e}if(32&y){a.mode=12;break t}t.msg="invalid literal/length code",a.mode=30;break t}v=65535&b,(y&=15)&&(f<y&&(m+=x[n++]<<f,f+=8),v+=m&(1<<y)-1,m>>>=y,f-=y),f<15&&(m+=x[n++]<<f,f+=8,m+=x[n++]<<f,f+=8),b=_[m&w];a:for(;;){if(m>>>=y=b>>>24,f-=y,!(16&(y=b>>>16&255))){if(0==(64&y)){b=_[(65535&b)+(m&(1<<y)-1)];continue a}t.msg="invalid distance code",a.mode=30;break t}if(M=65535&b,f<(y&=15)&&(m+=x[n++]<<f,(f+=8)<y&&(m+=x[n++]<<f,f+=8)),(M+=m&(1<<y)-1)>l){t.msg="invalid distance too far back",a.mode=30;break t}if(m>>>=y,f-=y,M>(y=r-s)){if((y=M-y)>c&&a.sane){t.msg="invalid distance too far back",a.mode=30;break t}if(A=0,k=u,0===d){if(A+=h-y,y<v){v-=y;do{T[r++]=u[A++]}while(--y);A=r-M,k=T}}else if(d<y){if(A+=h+d-y,(y-=d)<v){v-=y;do{T[r++]=u[A++]}while(--y);if(A=0,d<v){v-=y=d;do{T[r++]=u[A++]}while(--y);A=r-M,k=T}}}else if(A+=d-y,y<v){v-=y;do{T[r++]=u[A++]}while(--y);A=r-M,k=T}for(;v>2;)T[r++]=k[A++],T[r++]=k[A++],T[r++]=k[A++],v-=3;v&&(T[r++]=k[A++],v>1&&(T[r++]=k[A++]))}else{A=r-M;do{T[r++]=T[A++],T[r++]=T[A++],T[r++]=T[A++],v-=3}while(v>2);v&&(T[r++]=T[A++],v>1&&(T[r++]=T[A++]))}break}}break}}while(n<i&&r<o);n-=v=f>>3,m&=(1<<(f-=v<<3))-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<o?o-r+257:257-(r-o),a.hold=m,a.bits=f}},{}],11:[function(t,e,a){var n=t("../utils/common"),i=t("./adler32"),r=t("./crc32"),s=t("./inffast"),o=t("./inftrees"),l=0,h=1,c=2,d=4,u=5,m=6,f=0,p=1,_=2,g=-2,w=-3,b=-4,y=-5,v=8,M=1,A=2,k=3,x=4,T=5,B=6,z=7,E=8,I=9,O=10,S=11,V=12,D=13,P=14,L=15,G=16,j=17,F=18,U=19,N=20,C=21,X=22,K=23,R=24,Z=25,q=26,$=27,Q=28,Y=29,H=30,W=31,J=32,tt=852,et=592,at=15;function nt(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function it(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=M,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(tt),e.distcode=e.distdyn=new n.Buf32(et),e.sane=1,e.back=-1,f):g}function rt(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,it(t)):g}function st(t,e){var a,n;return t&&t.state?(n=t.state,e<0?(a=0,e=-e):(a=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?g:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=a,n.wbits=e,rt(t))):g}function ot(t,e){var a,i;return t?(i=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},t.state=i,i.window=null,(a=st(t,e))!==f&&(t.state=null),a):g}var lt,ht,ct=!0;function dt(t){if(ct){var e;for(lt=new n.Buf32(512),ht=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(h,t.lens,0,288,lt,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(c,t.lens,0,32,ht,0,t.work,{bits:5}),ct=!1}t.lencode=lt,t.lenbits=9,t.distcode=ht,t.distbits=5}function ut(t,e,a,i){var r,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new n.Buf8(s.wsize)),i>=s.wsize?(n.arraySet(s.window,e,a-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((r=s.wsize-s.wnext)>i&&(r=i),n.arraySet(s.window,e,a-i,r,s.wnext),(i-=r)?(n.arraySet(s.window,e,a-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0}a.inflateReset=rt,a.inflateReset2=st,a.inflateResetKeep=it,a.inflateInit=function(t){return ot(t,at)},a.inflateInit2=ot,a.inflate=function(t,e){var a,tt,et,at,it,rt,st,ot,lt,ht,ct,mt,ft,pt,_t,gt,wt,bt,yt,vt,Mt,At,kt,xt,Tt=0,Bt=new n.Buf8(4),zt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return g;(a=t.state).mode===V&&(a.mode=D),it=t.next_out,et=t.output,st=t.avail_out,at=t.next_in,tt=t.input,rt=t.avail_in,ot=a.hold,lt=a.bits,ht=rt,ct=st,At=f;t:for(;;)switch(a.mode){case M:if(0===a.wrap){a.mode=D;break}for(;lt<16;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}if(2&a.wrap&&35615===ot){a.check=0,Bt[0]=255&ot,Bt[1]=ot>>>8&255,a.check=r(a.check,Bt,2,0),ot=0,lt=0,a.mode=A;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&ot)<<8)+(ot>>8))%31){t.msg="incorrect header check",a.mode=H;break}if((15&ot)!==v){t.msg="unknown compression method",a.mode=H;break}if(lt-=4,Mt=8+(15&(ot>>>=4)),0===a.wbits)a.wbits=Mt;else if(Mt>a.wbits){t.msg="invalid window size",a.mode=H;break}a.dmax=1<<Mt,t.adler=a.check=1,a.mode=512&ot?O:V,ot=0,lt=0;break;case A:for(;lt<16;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}if(a.flags=ot,(255&a.flags)!==v){t.msg="unknown compression method",a.mode=H;break}if(57344&a.flags){t.msg="unknown header flags set",a.mode=H;break}a.head&&(a.head.text=ot>>8&1),512&a.flags&&(Bt[0]=255&ot,Bt[1]=ot>>>8&255,a.check=r(a.check,Bt,2,0)),ot=0,lt=0,a.mode=k;case k:for(;lt<32;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}a.head&&(a.head.time=ot),512&a.flags&&(Bt[0]=255&ot,Bt[1]=ot>>>8&255,Bt[2]=ot>>>16&255,Bt[3]=ot>>>24&255,a.check=r(a.check,Bt,4,0)),ot=0,lt=0,a.mode=x;case x:for(;lt<16;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}a.head&&(a.head.xflags=255&ot,a.head.os=ot>>8),512&a.flags&&(Bt[0]=255&ot,Bt[1]=ot>>>8&255,a.check=r(a.check,Bt,2,0)),ot=0,lt=0,a.mode=T;case T:if(1024&a.flags){for(;lt<16;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}a.length=ot,a.head&&(a.head.extra_len=ot),512&a.flags&&(Bt[0]=255&ot,Bt[1]=ot>>>8&255,a.check=r(a.check,Bt,2,0)),ot=0,lt=0}else a.head&&(a.head.extra=null);a.mode=B;case B:if(1024&a.flags&&((mt=a.length)>rt&&(mt=rt),mt&&(a.head&&(Mt=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Array(a.head.extra_len)),n.arraySet(a.head.extra,tt,at,mt,Mt)),512&a.flags&&(a.check=r(a.check,tt,mt,at)),rt-=mt,at+=mt,a.length-=mt),a.length))break t;a.length=0,a.mode=z;case z:if(2048&a.flags){if(0===rt)break t;mt=0;do{Mt=tt[at+mt++],a.head&&Mt&&a.length<65536&&(a.head.name+=String.fromCharCode(Mt))}while(Mt&&mt<rt);if(512&a.flags&&(a.check=r(a.check,tt,mt,at)),rt-=mt,at+=mt,Mt)break t}else a.head&&(a.head.name=null);a.length=0,a.mode=E;case E:if(4096&a.flags){if(0===rt)break t;mt=0;do{Mt=tt[at+mt++],a.head&&Mt&&a.length<65536&&(a.head.comment+=String.fromCharCode(Mt))}while(Mt&&mt<rt);if(512&a.flags&&(a.check=r(a.check,tt,mt,at)),rt-=mt,at+=mt,Mt)break t}else a.head&&(a.head.comment=null);a.mode=I;case I:if(512&a.flags){for(;lt<16;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}if(ot!==(65535&a.check)){t.msg="header crc mismatch",a.mode=H;break}ot=0,lt=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),t.adler=a.check=0,a.mode=V;break;case O:for(;lt<32;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}t.adler=a.check=nt(ot),ot=0,lt=0,a.mode=S;case S:if(0===a.havedict)return t.next_out=it,t.avail_out=st,t.next_in=at,t.avail_in=rt,a.hold=ot,a.bits=lt,_;t.adler=a.check=1,a.mode=V;case V:if(e===u||e===m)break t;case D:if(a.last){ot>>>=7&lt,lt-=7&lt,a.mode=$;break}for(;lt<3;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}switch(a.last=1&ot,lt-=1,3&(ot>>>=1)){case 0:a.mode=P;break;case 1:if(dt(a),a.mode=N,e===m){ot>>>=2,lt-=2;break t}break;case 2:a.mode=j;break;case 3:t.msg="invalid block type",a.mode=H}ot>>>=2,lt-=2;break;case P:for(ot>>>=7&lt,lt-=7&lt;lt<32;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}if((65535&ot)!=(ot>>>16^65535)){t.msg="invalid stored block lengths",a.mode=H;break}if(a.length=65535&ot,ot=0,lt=0,a.mode=L,e===m)break t;case L:a.mode=G;case G:if(mt=a.length){if(mt>rt&&(mt=rt),mt>st&&(mt=st),0===mt)break t;n.arraySet(et,tt,at,mt,it),rt-=mt,at+=mt,st-=mt,it+=mt,a.length-=mt;break}a.mode=V;break;case j:for(;lt<14;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}if(a.nlen=257+(31&ot),ot>>>=5,lt-=5,a.ndist=1+(31&ot),ot>>>=5,lt-=5,a.ncode=4+(15&ot),ot>>>=4,lt-=4,a.nlen>286||a.ndist>30){t.msg="too many length or distance symbols",a.mode=H;break}a.have=0,a.mode=F;case F:for(;a.have<a.ncode;){for(;lt<3;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}a.lens[zt[a.have++]]=7&ot,ot>>>=3,lt-=3}for(;a.have<19;)a.lens[zt[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,kt={bits:a.lenbits},At=o(l,a.lens,0,19,a.lencode,0,a.work,kt),a.lenbits=kt.bits,At){t.msg="invalid code lengths set",a.mode=H;break}a.have=0,a.mode=U;case U:for(;a.have<a.nlen+a.ndist;){for(;Tt=a.lencode[ot&(1<<a.lenbits)-1],gt=Tt>>>16&255,wt=65535&Tt,!((_t=Tt>>>24)<=lt);){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}if(wt<16)ot>>>=_t,lt-=_t,a.lens[a.have++]=wt;else{if(16===wt){for(xt=_t+2;lt<xt;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}if(ot>>>=_t,lt-=_t,0===a.have){t.msg="invalid bit length repeat",a.mode=H;break}Mt=a.lens[a.have-1],mt=3+(3&ot),ot>>>=2,lt-=2}else if(17===wt){for(xt=_t+3;lt<xt;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}lt-=_t,Mt=0,mt=3+(7&(ot>>>=_t)),ot>>>=3,lt-=3}else{for(xt=_t+7;lt<xt;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}lt-=_t,Mt=0,mt=11+(127&(ot>>>=_t)),ot>>>=7,lt-=7}if(a.have+mt>a.nlen+a.ndist){t.msg="invalid bit length repeat",a.mode=H;break}for(;mt--;)a.lens[a.have++]=Mt}}if(a.mode===H)break;if(0===a.lens[256]){t.msg="invalid code -- missing end-of-block",a.mode=H;break}if(a.lenbits=9,kt={bits:a.lenbits},At=o(h,a.lens,0,a.nlen,a.lencode,0,a.work,kt),a.lenbits=kt.bits,At){t.msg="invalid literal/lengths set",a.mode=H;break}if(a.distbits=6,a.distcode=a.distdyn,kt={bits:a.distbits},At=o(c,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,kt),a.distbits=kt.bits,At){t.msg="invalid distances set",a.mode=H;break}if(a.mode=N,e===m)break t;case N:a.mode=C;case C:if(rt>=6&&st>=258){t.next_out=it,t.avail_out=st,t.next_in=at,t.avail_in=rt,a.hold=ot,a.bits=lt,s(t,ct),it=t.next_out,et=t.output,st=t.avail_out,at=t.next_in,tt=t.input,rt=t.avail_in,ot=a.hold,lt=a.bits,a.mode===V&&(a.back=-1);break}for(a.back=0;Tt=a.lencode[ot&(1<<a.lenbits)-1],gt=Tt>>>16&255,wt=65535&Tt,!((_t=Tt>>>24)<=lt);){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}if(gt&&0==(240&gt)){for(bt=_t,yt=gt,vt=wt;Tt=a.lencode[vt+((ot&(1<<bt+yt)-1)>>bt)],gt=Tt>>>16&255,wt=65535&Tt,!(bt+(_t=Tt>>>24)<=lt);){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}ot>>>=bt,lt-=bt,a.back+=bt}if(ot>>>=_t,lt-=_t,a.back+=_t,a.length=wt,0===gt){a.mode=q;break}if(32&gt){a.back=-1,a.mode=V;break}if(64&gt){t.msg="invalid literal/length code",a.mode=H;break}a.extra=15&gt,a.mode=X;case X:if(a.extra){for(xt=a.extra;lt<xt;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}a.length+=ot&(1<<a.extra)-1,ot>>>=a.extra,lt-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=K;case K:for(;Tt=a.distcode[ot&(1<<a.distbits)-1],gt=Tt>>>16&255,wt=65535&Tt,!((_t=Tt>>>24)<=lt);){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}if(0==(240&gt)){for(bt=_t,yt=gt,vt=wt;Tt=a.distcode[vt+((ot&(1<<bt+yt)-1)>>bt)],gt=Tt>>>16&255,wt=65535&Tt,!(bt+(_t=Tt>>>24)<=lt);){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}ot>>>=bt,lt-=bt,a.back+=bt}if(ot>>>=_t,lt-=_t,a.back+=_t,64&gt){t.msg="invalid distance code",a.mode=H;break}a.offset=wt,a.extra=15&gt,a.mode=R;case R:if(a.extra){for(xt=a.extra;lt<xt;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}a.offset+=ot&(1<<a.extra)-1,ot>>>=a.extra,lt-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){t.msg="invalid distance too far back",a.mode=H;break}a.mode=Z;case Z:if(0===st)break t;if(mt=ct-st,a.offset>mt){if((mt=a.offset-mt)>a.whave&&a.sane){t.msg="invalid distance too far back",a.mode=H;break}mt>a.wnext?(mt-=a.wnext,ft=a.wsize-mt):ft=a.wnext-mt,mt>a.length&&(mt=a.length),pt=a.window}else pt=et,ft=it-a.offset,mt=a.length;mt>st&&(mt=st),st-=mt,a.length-=mt;do{et[it++]=pt[ft++]}while(--mt);0===a.length&&(a.mode=C);break;case q:if(0===st)break t;et[it++]=a.length,st--,a.mode=C;break;case $:if(a.wrap){for(;lt<32;){if(0===rt)break t;rt--,ot|=tt[at++]<<lt,lt+=8}if(ct-=st,t.total_out+=ct,a.total+=ct,ct&&(t.adler=a.check=a.flags?r(a.check,et,ct,it-ct):i(a.check,et,ct,it-ct)),ct=st,(a.flags?ot:nt(ot))!==a.check){t.msg="incorrect data check",a.mode=H;break}ot=0,lt=0}a.mode=Q;case Q:if(a.wrap&&a.flags){for(;lt<32;){if(0===rt)break t;rt--,ot+=tt[at++]<<lt,lt+=8}if(ot!==(4294967295&a.total)){t.msg="incorrect length check",a.mode=H;break}ot=0,lt=0}a.mode=Y;case Y:At=p;break t;case H:At=w;break t;case W:return b;case J:default:return g}return t.next_out=it,t.avail_out=st,t.next_in=at,t.avail_in=rt,a.hold=ot,a.bits=lt,(a.wsize||ct!==t.avail_out&&a.mode<H&&(a.mode<$||e!==d))&&ut(t,t.output,t.next_out,ct-t.avail_out),ht-=t.avail_in,ct-=t.avail_out,t.total_in+=ht,t.total_out+=ct,a.total+=ct,a.wrap&&ct&&(t.adler=a.check=a.flags?r(a.check,et,ct,t.next_out-ct):i(a.check,et,ct,t.next_out-ct)),t.data_type=a.bits+(a.last?64:0)+(a.mode===V?128:0)+(a.mode===N||a.mode===L?256:0),(0===ht&&0===ct||e===d)&&At===f&&(At=y),At},a.inflateEnd=function(t){if(!t||!t.state)return g;var e=t.state;return e.window&&(e.window=null),t.state=null,f},a.inflateGetHeader=function(t,e){var a;return t&&t.state?0==(2&(a=t.state).wrap)?g:(a.head=e,e.done=!1,f):g},a.inflateSetDictionary=function(t,e){var a,n=e.length;return t&&t.state?0!==(a=t.state).wrap&&a.mode!==S?g:a.mode===S&&i(1,e,n,0)!==a.check?w:ut(t,e,n,n)?(a.mode=W,b):(a.havedict=1,f):g},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(t,e,a){var n=t("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,a,l,h,c,d,u){var m,f,p,_,g,w,b,y,v,M=u.bits,A=0,k=0,x=0,T=0,B=0,z=0,E=0,I=0,O=0,S=0,V=null,D=0,P=new n.Buf16(16),L=new n.Buf16(16),G=null,j=0;for(A=0;A<=15;A++)P[A]=0;for(k=0;k<l;k++)P[e[a+k]]++;for(B=M,T=15;T>=1&&0===P[T];T--);if(B>T&&(B=T),0===T)return h[c++]=20971520,h[c++]=20971520,u.bits=1,0;for(x=1;x<T&&0===P[x];x++);for(B<x&&(B=x),I=1,A=1;A<=15;A++)if(I<<=1,(I-=P[A])<0)return-1;if(I>0&&(0===t||1!==T))return-1;for(L[1]=0,A=1;A<15;A++)L[A+1]=L[A]+P[A];for(k=0;k<l;k++)0!==e[a+k]&&(d[L[e[a+k]]++]=k);if(0===t?(V=G=d,w=19):1===t?(V=i,D-=257,G=r,j-=257,w=256):(V=s,G=o,w=-1),S=0,k=0,A=x,g=c,z=B,E=0,p=-1,_=(O=1<<B)-1,1===t&&O>852||2===t&&O>592)return 1;for(;;){b=A-E,d[k]<w?(y=0,v=d[k]):d[k]>w?(y=G[j+d[k]],v=V[D+d[k]]):(y=96,v=0),m=1<<A-E,x=f=1<<z;do{h[g+(S>>E)+(f-=m)]=b<<24|y<<16|v|0}while(0!==f);for(m=1<<A-1;S&m;)m>>=1;if(0!==m?(S&=m-1,S+=m):S=0,k++,0==--P[A]){if(A===T)break;A=e[a+d[k]]}if(A>B&&(S&_)!==p){for(0===E&&(E=B),g+=x,I=1<<(z=A-E);z+E<T&&!((I-=P[z+E])<=0);)z++,I<<=1;if(O+=1<<z,1===t&&O>852||2===t&&O>592)return 1;h[p=S&_]=B<<24|z<<16|g-c|0}}return 0!==S&&(h[g+S]=A-E<<24|64<<16|0),u.bits=B,0}},{"../utils/common":3}],13:[function(t,e,a){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(t,e,a){var n=t("../utils/common"),i=4,r=0,s=1,o=2;function l(t){for(var e=t.length;--e>=0;)t[e]=0}var h=0,c=1,d=2,u=29,m=256,f=m+1+u,p=30,_=19,g=2*f+1,w=15,b=16,y=7,v=256,M=16,A=17,k=18,x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],E=new Array(2*(f+2));l(E);var I=new Array(2*p);l(I);var O=new Array(512);l(O);var S=new Array(256);l(S);var V=new Array(u);l(V);var D,P,L,G=new Array(p);function j(t,e,a,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=a,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}function F(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function U(t){return t<256?O[t]:O[256+(t>>>7)]}function N(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function C(t,e,a){t.bi_valid>b-a?(t.bi_buf|=e<<t.bi_valid&65535,N(t,t.bi_buf),t.bi_buf=e>>b-t.bi_valid,t.bi_valid+=a-b):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=a)}function X(t,e,a){C(t,a[2*e],a[2*e+1])}function K(t,e){var a=0;do{a|=1&t,t>>>=1,a<<=1}while(--e>0);return a>>>1}function R(t,e,a){var n,i,r=new Array(w+1),s=0;for(n=1;n<=w;n++)r[n]=s=s+a[n-1]<<1;for(i=0;i<=e;i++){var o=t[2*i+1];0!==o&&(t[2*i]=K(r[o]++,o))}}function Z(t){var e;for(e=0;e<f;e++)t.dyn_ltree[2*e]=0;for(e=0;e<p;e++)t.dyn_dtree[2*e]=0;for(e=0;e<_;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*v]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function q(t){t.bi_valid>8?N(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function $(t,e,a,n){var i=2*e,r=2*a;return t[i]<t[r]||t[i]===t[r]&&n[e]<=n[a]}function Q(t,e,a){for(var n=t.heap[a],i=a<<1;i<=t.heap_len&&(i<t.heap_len&&$(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!$(e,n,t.heap[i],t.depth));)t.heap[a]=t.heap[i],a=i,i<<=1;t.heap[a]=n}function Y(t,e,a){var n,i,r,s,o=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],i=t.pending_buf[t.l_buf+o],o++,0===n?X(t,i,e):(r=S[i],X(t,r+m+1,e),0!==(s=x[r])&&(i-=V[r],C(t,i,s)),r=U(--n),X(t,r,a),0!==(s=T[r])&&(n-=G[r],C(t,n,s)))}while(o<t.last_lit);X(t,v,e)}function H(t,e){var a,n,i,r=e.dyn_tree,s=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=g,a=0;a<l;a++)0!==r[2*a]?(t.heap[++t.heap_len]=h=a,t.depth[a]=0):r[2*a+1]=0;for(;t.heap_len<2;)i=t.heap[++t.heap_len]=h<2?++h:0,r[2*i]=1,t.depth[i]=0,t.opt_len--,o&&(t.static_len-=s[2*i+1]);for(e.max_code=h,a=t.heap_len>>1;a>=1;a--)Q(t,r,a);i=l;do{a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Q(t,r,1),n=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=n,r[2*i]=r[2*a]+r[2*n],t.depth[i]=(t.depth[a]>=t.depth[n]?t.depth[a]:t.depth[n])+1,r[2*a+1]=r[2*n+1]=i,t.heap[1]=i++,Q(t,r,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var a,n,i,r,s,o,l=e.dyn_tree,h=e.max_code,c=e.stat_desc.static_tree,d=e.stat_desc.has_stree,u=e.stat_desc.extra_bits,m=e.stat_desc.extra_base,f=e.stat_desc.max_length,p=0;for(r=0;r<=w;r++)t.bl_count[r]=0;for(l[2*t.heap[t.heap_max]+1]=0,a=t.heap_max+1;a<g;a++)n=t.heap[a],(r=l[2*l[2*n+1]+1]+1)>f&&(r=f,p++),l[2*n+1]=r,n>h||(t.bl_count[r]++,s=0,n>=m&&(s=u[n-m]),o=l[2*n],t.opt_len+=o*(r+s),d&&(t.static_len+=o*(c[2*n+1]+s)));if(0!==p){do{for(r=f-1;0===t.bl_count[r];)r--;t.bl_count[r]--,t.bl_count[r+1]+=2,t.bl_count[f]--,p-=2}while(p>0);for(r=f;0!==r;r--)for(n=t.bl_count[r];0!==n;)(i=t.heap[--a])>h||(l[2*i+1]!==r&&(t.opt_len+=(r-l[2*i+1])*l[2*i],l[2*i+1]=r),n--)}}(t,e),R(r,h,t.bl_count)}function W(t,e,a){var n,i,r=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),e[2*(a+1)+1]=65535,n=0;n<=a;n++)i=s,s=e[2*(n+1)+1],++o<l&&i===s||(o<h?t.bl_tree[2*i]+=o:0!==i?(i!==r&&t.bl_tree[2*i]++,t.bl_tree[2*M]++):o<=10?t.bl_tree[2*A]++:t.bl_tree[2*k]++,o=0,r=i,0===s?(l=138,h=3):i===s?(l=6,h=3):(l=7,h=4))}function J(t,e,a){var n,i,r=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),n=0;n<=a;n++)if(i=s,s=e[2*(n+1)+1],!(++o<l&&i===s)){if(o<h)do{X(t,i,t.bl_tree)}while(0!=--o);else 0!==i?(i!==r&&(X(t,i,t.bl_tree),o--),X(t,M,t.bl_tree),C(t,o-3,2)):o<=10?(X(t,A,t.bl_tree),C(t,o-3,3)):(X(t,k,t.bl_tree),C(t,o-11,7));o=0,r=i,0===s?(l=138,h=3):i===s?(l=6,h=3):(l=7,h=4)}}l(G);var tt=!1;function et(t,e,a,i){C(t,(h<<1)+(i?1:0),3),function(t,e,a,i){q(t),i&&(N(t,a),N(t,~a)),n.arraySet(t.pending_buf,t.window,e,a,t.pending),t.pending+=a}(t,e,a,!0)}a._tr_init=function(t){tt||(function(){var t,e,a,n,i,r=new Array(w+1);for(a=0,n=0;n<u-1;n++)for(V[n]=a,t=0;t<1<<x[n];t++)S[a++]=n;for(S[a-1]=n,i=0,n=0;n<16;n++)for(G[n]=i,t=0;t<1<<T[n];t++)O[i++]=n;for(i>>=7;n<p;n++)for(G[n]=i<<7,t=0;t<1<<T[n]-7;t++)O[256+i++]=n;for(e=0;e<=w;e++)r[e]=0;for(t=0;t<=143;)E[2*t+1]=8,t++,r[8]++;for(;t<=255;)E[2*t+1]=9,t++,r[9]++;for(;t<=279;)E[2*t+1]=7,t++,r[7]++;for(;t<=287;)E[2*t+1]=8,t++,r[8]++;for(R(E,f+1,r),t=0;t<p;t++)I[2*t+1]=5,I[2*t]=K(t,5);D=new j(E,x,m+1,f,w),P=new j(I,T,0,p,w),L=new j(new Array(0),B,0,_,y)}(),tt=!0),t.l_desc=new F(t.dyn_ltree,D),t.d_desc=new F(t.dyn_dtree,P),t.bl_desc=new F(t.bl_tree,L),t.bi_buf=0,t.bi_valid=0,Z(t)},a._tr_stored_block=et,a._tr_flush_block=function(t,e,a,n){var l,h,u=0;t.level>0?(t.strm.data_type===o&&(t.strm.data_type=function(t){var e,a=4093624447;for(e=0;e<=31;e++,a>>>=1)if(1&a&&0!==t.dyn_ltree[2*e])return r;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return s;for(e=32;e<m;e++)if(0!==t.dyn_ltree[2*e])return s;return r}(t)),H(t,t.l_desc),H(t,t.d_desc),u=function(t){var e;for(W(t,t.dyn_ltree,t.l_desc.max_code),W(t,t.dyn_dtree,t.d_desc.max_code),H(t,t.bl_desc),e=_-1;e>=3&&0===t.bl_tree[2*z[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),l=t.opt_len+3+7>>>3,(h=t.static_len+3+7>>>3)<=l&&(l=h)):l=h=a+5,a+4<=l&&-1!==e?et(t,e,a,n):t.strategy===i||h===l?(C(t,(c<<1)+(n?1:0),3),Y(t,E,I)):(C(t,(d<<1)+(n?1:0),3),function(t,e,a,n){var i;for(C(t,e-257,5),C(t,a-1,5),C(t,n-4,4),i=0;i<n;i++)C(t,t.bl_tree[2*z[i]+1],3);J(t,t.dyn_ltree,e-1),J(t,t.dyn_dtree,a-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,u+1),Y(t,t.dyn_ltree,t.dyn_dtree)),Z(t),n&&q(t)},a._tr_tally=function(t,e,a){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&a,t.last_lit++,0===e?t.dyn_ltree[2*a]++:(t.matches++,e--,t.dyn_ltree[2*(S[a]+m+1)]++,t.dyn_dtree[2*U(e)]++),t.last_lit===t.lit_bufsize-1},a._tr_align=function(t){C(t,c<<1,3),X(t,v,E),function(t){16===t.bi_valid?(N(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":3}],15:[function(t,e,a){e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/":[function(t,e,a){var n=t("./lib/utils/common").assign,i=t("./lib/deflate"),r=t("./lib/inflate"),s=t("./lib/zlib/constants"),o={};n(o,i,r,s),e.exports=o},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")}),p=Object.freeze({__proto__:null,default:pako,__moduleExports:pako});let pako$1=p;pako$1.inflate||(pako$1=pako$1.default);const XKT_VERSION=8;function writeXKTModelToArrayBuffer(t){return createArrayBuffer(deflateData(getModelData(t)))}function getModelData(t){const e=t.metaObjectsList,a=t.geometriesList,n=t.meshesList,i=t.entitiesList,r=t.tilesList,s=e.length,o=a.length,l=n.length,h=i.length,c=r.length;let d=0,u=0,m=0,f=0,p=0,_=0;for(let t=0;t<o;t++){const e=a[t];e.positionsQuantized&&(d+=e.positionsQuantized.length),e.normalsOctEncoded&&(u+=e.normalsOctEncoded.length),e.colorsCompressed&&(m+=e.colorsCompressed.length),e.indices&&(f+=e.indices.length),e.edgeIndices&&(p+=e.edgeIndices.length)}for(let t=0;t<l;t++){n[t].geometry.numInstances>1&&(_+=16)}const g={types:[],eachMetaObjectId:[],eachMetaObjectType:new Uint32Array(s),eachMetaObjectName:[],eachMetaObjectParent:new Uint32Array(s),positions:new Uint16Array(d),normals:new Int8Array(u),colors:new Uint8Array(m),indices:new Uint32Array(f),edgeIndices:new Uint32Array(p),matrices:new Float32Array(_),reusedGeometriesDecodeMatrix:new Float32Array(t.reusedGeometriesDecodeMatrix),eachGeometryPrimitiveType:new Uint8Array(o),eachGeometryPositionsPortion:new Uint32Array(o),eachGeometryNormalsPortion:new Uint32Array(o),eachGeometryColorsPortion:new Uint32Array(o),eachGeometryIndicesPortion:new Uint32Array(o),eachGeometryEdgeIndicesPortion:new Uint32Array(o),eachMeshGeometriesPortion:new Uint32Array(l),eachMeshMatricesPortion:new Uint32Array(l),eachMeshMaterial:new Uint8Array(6*l),eachEntityMetaObject:new Uint32Array(h),eachEntityMeshesPortion:new Uint32Array(h),eachTileAABB:new Float64Array(6*c),eachTileEntitiesPortion:new Uint32Array(c)};let w=0,b=0,y=0,v=0,M=0,A=0;const k={};for(let a=0;a<s;a++){const n=e[a],i=n.metaObjectId,r=n.metaObjectType,s=n.metaObjectName,o=n.parentMetaObjectId;let l=k[r];void 0===l&&(l=g.types.length,k[r]=l,g.types.push(r)),g.eachMetaObjectId[a]=i,g.eachMetaObjectType[a]=l,g.eachMetaObjectName[a]=s;const h=t.metaObjects[o];h&&(g.eachMetaObjectParent[a]=h.metaObjectIndex)}let x=0;for(let t=0;t<o;t++){const e=a[t],n="triangles"===e.primitiveType?e.solid?0:1:"points"===e.primitiveType?2:3;g.eachGeometryPrimitiveType[t]=n,g.eachGeometryPositionsPortion[t]=w,g.eachGeometryNormalsPortion[t]=b,g.eachGeometryColorsPortion[t]=y,g.eachGeometryIndicesPortion[t]=v,g.eachGeometryEdgeIndicesPortion[t]=M,e.positionsQuantized&&(g.positions.set(e.positionsQuantized,w),w+=e.positionsQuantized.length),e.normalsOctEncoded&&(g.normals.set(e.normalsOctEncoded,b),b+=e.normalsOctEncoded.length),e.colorsCompressed&&(g.colors.set(e.colorsCompressed,y),y+=e.colorsCompressed.length),e.indices&&(g.indices.set(e.indices,v),v+=e.indices.length),e.edgeIndices&&(g.edgeIndices.set(e.edgeIndices,M),M+=e.edgeIndices.length)}for(let t=0;t<l;t++){const e=n[t];e.geometry.numInstances>1&&(g.matrices.set(e.matrix,x),g.eachMeshMatricesPortion[t]=x,x+=16),g.eachMeshMaterial[A+0]=Math.floor(255*e.color[0]),g.eachMeshMaterial[A+1]=Math.floor(255*e.color[1]),g.eachMeshMaterial[A+2]=Math.floor(255*e.color[2]),g.eachMeshMaterial[A+3]=Math.floor(255*e.opacity),g.eachMeshMaterial[A+4]=Math.floor(255*e.metallic),g.eachMeshMaterial[A+5]=Math.floor(255*e.roughness),A+=6}let T=0,B=0;for(let e=0;e<c;e++){const a=r[e],n=a.entities,i=n.length;if(0===i)continue;g.eachTileEntitiesPortion[e]=T;const s=a.aabb;for(let e=0;e<i;e++){const a=n[e],i=a.meshes,r=i.length;if(0===r)continue;for(let t=0;t<r;t++){const e=i[t].geometry.geometryIndex;g.eachMeshGeometriesPortion[B+t]=e}const s=t.metaObjects[a.entityId];g.eachEntityMetaObject[T]=s.metaObjectIndex,g.eachEntityMeshesPortion[T]=B,T++,B+=r}const o=6*e;g.eachTileAABB.set(s,o)}return g}function deflateData(t){return{types:pako$1.deflate(deflateStrings(t.types)),eachMetaObjectId:pako$1.deflate(deflateStrings(t.eachMetaObjectId)),eachMetaObjectType:pako$1.deflate(t.eachMetaObjectType.buffer),eachMetaObjectName:pako$1.deflate(deflateStrings(t.eachMetaObjectName)),eachMetaObjectParent:pako$1.deflate(t.eachMetaObjectParent.buffer),positions:pako$1.deflate(t.positions.buffer),normals:pako$1.deflate(t.normals.buffer),colors:pako$1.deflate(t.colors.buffer),indices:pako$1.deflate(t.indices.buffer),edgeIndices:pako$1.deflate(t.edgeIndices.buffer),matrices:pako$1.deflate(t.matrices.buffer),reusedGeometriesDecodeMatrix:pako$1.deflate(t.reusedGeometriesDecodeMatrix.buffer),eachGeometryPrimitiveType:pako$1.deflate(t.eachGeometryPrimitiveType.buffer),eachGeometryPositionsPortion:pako$1.deflate(t.eachGeometryPositionsPortion.buffer),eachGeometryNormalsPortion:pako$1.deflate(t.eachGeometryNormalsPortion.buffer),eachGeometryColorsPortion:pako$1.deflate(t.eachGeometryColorsPortion.buffer),eachGeometryIndicesPortion:pako$1.deflate(t.eachGeometryIndicesPortion.buffer),eachGeometryEdgeIndicesPortion:pako$1.deflate(t.eachGeometryEdgeIndicesPortion.buffer),eachMeshGeometriesPortion:pako$1.deflate(t.eachMeshGeometriesPortion.buffer),eachMeshMatricesPortion:pako$1.deflate(t.eachMeshMatricesPortion.buffer),eachMeshMaterial:pako$1.deflate(t.eachMeshMaterial.buffer),eachEntityMetaObject:pako$1.deflate(t.eachEntityMetaObject.buffer),eachEntityMeshesPortion:pako$1.deflate(t.eachEntityMeshesPortion.buffer),eachTileAABB:pako$1.deflate(t.eachTileAABB.buffer),eachTileEntitiesPortion:pako$1.deflate(t.eachTileEntitiesPortion.buffer)}}function deflateStrings(t){return JSON.stringify(t).replace(/[\u007F-\uFFFF]/g,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).substr(-4)})}function createArrayBuffer(t){return toArrayBuffer([t.types,t.eachMetaObjectId,t.eachMetaObjectType,t.eachMetaObjectName,t.eachMetaObjectParent,t.positions,t.normals,t.colors,t.indices,t.edgeIndices,t.matrices,t.reusedGeometriesDecodeMatrix,t.eachGeometryPrimitiveType,t.eachGeometryPositionsPortion,t.eachGeometryNormalsPortion,t.eachGeometryColorsPortion,t.eachGeometryIndicesPortion,t.eachGeometryEdgeIndicesPortion,t.eachMeshGeometriesPortion,t.eachMeshMatricesPortion,t.eachMeshMaterial,t.eachEntityMetaObject,t.eachEntityMeshesPortion,t.eachTileAABB,t.eachTileEntitiesPortion])}function toArrayBuffer(t){const e=new Uint32Array(t.length+2);e[0]=XKT_VERSION,e[1]=t.length;let a=0;for(let n=0,i=t.length;n<i;n++){const i=t[n].length;e[n+2]=i,a+=i}const n=new Uint8Array(e.buffer),i=new Uint8Array(n.length+a);i.set(n);let r=n.length;for(let e=0,a=t.length;e<a;e++){const a=t[e];i.set(a,r),r+=a.length}return console.log("Array buffer size: "+(i.length/1024).toFixed(3)+" kB"),i.buffer}function isString(t){return"string"==typeof t||t instanceof String}const utils={isString:isString},atob2="undefined"!=typeof atob?atob:t=>Buffer.from(t,"base64").toString("binary"),WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};async function parseGLTFIntoXKTModel(t,e,a){const n={gltf:t,getAttachment:a||(()=>{throw new Error("You must define getAttachment() method to convert glTF with external resources")}),xktModel:e,geometryCreated:{},nextGeometryId:0,nextMeshId:0,nextDefaultEntityId:0};await parseBuffers(n),parseBufferViews(n),freeBuffers(n),parseMaterials(n),parseDefaultScene(n)}async function parseBuffers(t){const e=t.gltf.buffers;e&&await Promise.all(e.map(e=>parseBuffer(t,e)))}async function parseBuffer(t,e){const a=e.uri;if(!a)throw new Error("gltf/handleBuffer missing uri in "+JSON.stringify(e));e._buffer=await parseArrayBuffer(t,a)}async function parseArrayBuffer(t,e){const a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){const t=!!a[2];let e=a[3];e=decodeURIComponent(e),t&&(e=atob2(e));const n=new ArrayBuffer(e.length),i=new Uint8Array(n);for(let t=0;t<e.length;t++)i[t]=e.charCodeAt(t);return n}return await t.getAttachment(e)}function parseBufferViews(t){const e=t.gltf.bufferViews;if(e)for(let a=0,n=e.length;a<n;a++)parseBufferView(t,e[a])}function parseBufferView(t,e){const a=t.gltf.buffers[e.buffer];e._typedArray=null;const n=e.byteLength||0,i=e.byteOffset||0;e._buffer=a._buffer.slice(i,i+n)}function freeBuffers(t){const e=t.gltf.buffers;if(e)for(let t=0,a=e.length;t<a;t++)e[t]._buffer=null}function parseMaterials(t){const e=t.gltf.materials;if(e)for(let a=0,n=e.length;a<n;a++){const n=e[a],i=parseMaterial(t,n);n._materialData=i}}function parseMaterial(t,e){const a={color:new Float32Array([1,1,1]),opacity:1,metallic:0,roughness:1},n=e.extensions;if(n){const t=n.KHR_materials_pbrSpecularGlossiness;if(t){const e=t.diffuseFactor;null!==e&&void 0!==e&&(a.color[0]=e[0],a.color[1]=e[1],a.color[2]=e[2])}const e=n.KHR_materials_common;if(e){const t=e.technique,n=e.values||{},i="BLINN"===t,r="PHONG"===t,s="LAMBERT"===t,o=n.diffuse;o&&(i||r||s)&&(utils.isString(o)||(a.color[0]=o[0],a.color[1]=o[1],a.color[2]=o[2]));const l=n.transparency;null!==l&&void 0!==l&&(a.opacity=l);const h=n.transparent;null!==h&&void 0!==h&&(a.opacity=h)}}const i=e.pbrMetallicRoughness;if(i){const t=i.baseColorFactor;t&&(a.color[0]=t[0],a.color[1]=t[1],a.color[2]=t[2],a.opacity=t[3]);const e=i.metallicFactor;null!==e&&void 0!==e&&(a.metallic=e);const n=i.roughnessFactor;null!==n&&void 0!==n&&(a.roughness=n)}return a}function parseDefaultScene(t){const e=t.gltf.scene||0,a=t.gltf.scenes[e];if(!a)throw new Error("glTF has no default scene");parseScene(t,a)}function parseScene(t,e){const a=e.nodes;if(a)for(let e=0,n=a.length;e<n;e++){const n=t.gltf.nodes[a[e]];n&&parseNode(t,n,null)}}function parseNode(t,e,a){const n=t.gltf,i=t.xktModel;let r;e.matrix&&(r=e.matrix,a=a?math.mulMat4(a,r,math.mat4()):r),e.translation&&(r=math.translationMat4v(e.translation),a=a?math.mulMat4(a,r,r):r),e.rotation&&(r=math.quaternionToMat4(e.rotation),a=a?math.mulMat4(a,r,r):r),e.scale&&(r=math.scalingMat4v(e.scale),a=a?math.mulMat4(a,r,r):r);const s=e.mesh;if(void 0!==s){const r=n.meshes[s];if(r){const s=r.primitives.length;if(s>0){const o=[];for(let e=0;e<s;e++){const s=r.primitives[e],l=s.material,h=null!==l&&void 0!==l?n.materials[l]:null,c=h?h._materialData.color:new Float32Array([1,1,1,1]),d=h?h._materialData.opacity:1,u=h?h._materialData.metallic:0,m=h?h._materialData.roughness:1,f=createPrimitiveGeometryHash(s);if(!t.geometryCreated[f]){const e={};parsePrimitiveGeometry(t,s,e);const a=e.colors;let n;if(e.colors){n=[];for(let t=0,e=a.length;t<e;t+=4)n.push(Math.floor(255*a[t+0])),n.push(Math.floor(255*a[t+1])),n.push(Math.floor(255*a[t+2]))}i.createGeometry({geometryId:f,primitiveType:e.primitive,positions:e.positions,normals:e.normals,colorsCompressed:n,indices:e.indices}),t.geometryCreated[f]=!0}const p=t.nextMeshId++;i.createMesh({meshId:p,geometryId:f,matrix:a?a.slice():math.identityMat4(),color:c,opacity:d,metallic:u,roughness:m}),o.push(p)}const l=e.name||"entity"+t.nextDefaultEntityId++;i.createEntity({entityId:l,meshIds:o})}}}if(e.children){const i=e.children;for(let e=0,r=i.length;e<r;e++){const r=i[e],s=n.nodes[r];s?parseNode(t,s,a):console.warn("Node not found: "+e)}}}function createPrimitiveGeometryHash(t){return t.attributes?[t.mode,null!==t.indices&&void 0!==t.indices?t.indices:"-",null!==t.positions&&void 0!==t.positions?t.positions:"-",null!==t.normals&&void 0!==t.normals?t.normals:"-",null!==t.colors&&void 0!==t.colors?t.colors:"-"].join(";"):"empty"}function parsePrimitiveGeometry(t,e,a){const n=e.attributes;if(!n)return;switch(e.mode){case 0:a.primitive="points";break;case 1:case 2:case 3:a.primitive="lines";break;case 4:case 5:case 6:a.primitive="triangles"}const i=t.gltf.accessors,r=e.indices;if(null!==r&&void 0!==r){const e=i[r];a.indices=parseAccessorTypedArray(t,e)}const s=n.POSITION;if(null!==s&&void 0!==s){const e=i[s];a.positions=parseAccessorTypedArray(t,e)}const o=n.NORMAL;if(null!==o&&void 0!==o){const e=i[o];a.normals=parseAccessorTypedArray(t,e)}const l=n.COLOR_0;if(null!==l&&void 0!==l){const e=i[l];a.colors=parseAccessorTypedArray(t,e)}}function parseAccessorTypedArray(t,e){const a=t.gltf.bufferViews[e.bufferView],n=WEBGL_TYPE_SIZES[e.type],i=WEBGL_COMPONENT_TYPES[e.componentType],r=i.BYTES_PER_ELEMENT*n;if(e.byteStride&&e.byteStride!==r)throw new Error("interleaved buffer!");return new i(a._buffer,e.byteOffset||0,e.count*n)}function parseMetaModelIntoXKTModel(t,e,a={}){t.projectId,t.revisionId;const n=t.metaObjects||[];t.author,t.createdAt,t.creatingApplication,t.schema;let i,r;if(a.includeTypes){i={};for(let t=0,e=a.includeTypes.length;t<e;t++)i[a.includeTypes[t]]=!0}if(a.excludeTypes){r={};for(let t=0,e=a.excludeTypes.length;t<e;t++)i[a.excludeTypes[t]]=!0}for(let t=0,a=n.length;t<a;t++){const a=n[t],s=a.type;r&&r[s]||(i&&!i[s]||e.createMetaObject({metaObjectId:a.id,metaObjectType:a.type,metaObjectName:a.name,parentMetaObjectId:a.parent}))}}function buildBoxGeometry(t={}){let e=t.xSize||1;e<0&&(console.error("negative xSize not allowed - will invert"),e*=-1);let a=t.ySize||1;a<0&&(console.error("negative ySize not allowed - will invert"),a*=-1);let n=t.zSize||1;n<0&&(console.error("negative zSize not allowed - will invert"),n*=-1);const i=t.center,r=i?i[0]:0,s=i?i[1]:0,o=i?i[2]:0,l=-e+r,h=-a+s,c=-n+o,d=e+r,u=a+s,m=n+o;return{primitiveType:"triangles",positions:[d,u,m,l,u,m,l,h,m,d,h,m,d,u,m,d,h,m,d,h,c,d,u,c,d,u,m,d,u,c,l,u,c,l,u,m,l,u,m,l,u,c,l,h,c,l,h,m,l,h,c,d,h,c,d,h,m,l,h,m,d,h,c,l,h,c,l,u,c,d,u,c],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}function buildBoxLinesGeometry(t={}){let e=t.xSize||1;e<0&&(console.error("negative xSize not allowed - will invert"),e*=-1);let a=t.ySize||1;a<0&&(console.error("negative ySize not allowed - will invert"),a*=-1);let n=t.zSize||1;n<0&&(console.error("negative zSize not allowed - will invert"),n*=-1);const i=t.center,r=i?i[0]:0,s=i?i[1]:0,o=i?i[2]:0,l=-e+r,h=-a+s,c=-n+o,d=e+r,u=a+s,m=n+o;return{primitiveType:"lines",positions:[l,h,c,l,h,m,l,u,c,l,u,m,d,h,c,d,h,m,d,u,c,d,u,m],indices:[0,1,1,3,3,2,2,0,4,5,5,7,7,6,6,4,0,4,1,5,2,6,3,7]}}function buildCylinderGeometry(t={}){let e=t.radiusTop||1;e<0&&(console.error("negative radiusTop not allowed - will invert"),e*=-1);let a=t.radiusBottom||1;a<0&&(console.error("negative radiusBottom not allowed - will invert"),a*=-1);let n=t.height||1;n<0&&(console.error("negative height not allowed - will invert"),n*=-1);let i=t.radialSegments||32;i<0&&(console.error("negative radialSegments not allowed - will invert"),i*=-1),i<3&&(i=3);let r=t.heightSegments||1;r<0&&(console.error("negative heightSegments not allowed - will invert"),r*=-1),r<1&&(r=1);const s=!!t.openEnded;let o=t.center;const l=o?o[0]:0,h=o?o[1]:0,c=o?o[2]:0,d=n/2,u=n/r,m=2*Math.PI/i,f=1/i,p=(e-a)/r,_=[],g=[],w=[],b=[];let y,v,M,A,k,x,T,B,z,E,I;const O=(90-180*Math.atan(n/(a-e))/Math.PI)/90;for(y=0;y<=r;y++)for(k=e-y*p,x=d-y*u,v=0;v<=i;v++)M=Math.sin(v*m),A=Math.cos(v*m),g.push(k*M),g.push(O),g.push(k*A),w.push(v*f),w.push(1*y/r),_.push(k*M+l),_.push(x+h),_.push(k*A+c);for(y=0;y<r;y++)for(v=0;v<=i;v++)B=(T=y*(i+1)+v)+i,b.push(T),b.push(B),b.push(B+1),b.push(T),b.push(B+1),b.push(T+1);if(!s&&e>0){for(z=_.length/3,g.push(0),g.push(1),g.push(0),w.push(.5),w.push(.5),_.push(0+l),_.push(d+h),_.push(0+c),v=0;v<=i;v++)M=Math.sin(v*m),A=Math.cos(v*m),E=.5*Math.sin(v*m)+.5,I=.5*Math.cos(v*m)+.5,g.push(e*M),g.push(1),g.push(e*A),w.push(E),w.push(I),_.push(e*M+l),_.push(d+h),_.push(e*A+c);for(v=0;v<i;v++)o=z,T=z+1+v,b.push(T),b.push(T+1),b.push(o)}if(!s&&a>0){for(z=_.length/3,g.push(0),g.push(-1),g.push(0),w.push(.5),w.push(.5),_.push(0+l),_.push(0-d+h),_.push(0+c),v=0;v<=i;v++)M=Math.sin(v*m),A=Math.cos(v*m),E=.5*Math.sin(v*m)+.5,I=.5*Math.cos(v*m)+.5,g.push(a*M),g.push(-1),g.push(a*A),w.push(E),w.push(I),_.push(a*M+l),_.push(0-d+h),_.push(a*A+c);for(v=0;v<i;v++)o=z,T=z+1+v,b.push(o),b.push(T+1),b.push(T)}return{primitiveType:"triangles",positions:_,normals:g,uv:w,indices:b}}function buildGridGeometry(t={}){let e=t.size||1;e<0&&(console.error("negative size not allowed - will invert"),e*=-1);let a=t.divisions||1;a<0&&(console.error("negative divisions not allowed - will invert"),a*=-1),a<1&&(a=1);const n=(e=e||10)/(a=a||10),i=e/2,r=[],s=[];let o=0;for(let t=0,e=-i;t<=a;t++,e+=n)r.push(-i),r.push(0),r.push(e),r.push(i),r.push(0),r.push(e),r.push(e),r.push(0),r.push(-i),r.push(e),r.push(0),r.push(i),s.push(o++),s.push(o++),s.push(o++),s.push(o++);return{primitiveType:"lines",positions:r,indices:s}}function buildPlaneGeometry(t={}){let e=t.xSize||1;e<0&&(console.error("negative xSize not allowed - will invert"),e*=-1);let a=t.zSize||1;a<0&&(console.error("negative zSize not allowed - will invert"),a*=-1);let n=t.xSegments||1;n<0&&(console.error("negative xSegments not allowed - will invert"),n*=-1),n<1&&(n=1);let i=t.xSegments||1;i<0&&(console.error("negative zSegments not allowed - will invert"),i*=-1),i<1&&(i=1);const r=t.center,s=r?r[0]:0,o=r?r[1]:0,l=r?r[2]:0,h=e/2,c=a/2,d=Math.floor(n)||1,u=Math.floor(i)||1,m=d+1,f=u+1,p=e/d,_=a/u,g=new Float32Array(m*f*3),w=new Float32Array(m*f*3),b=new Float32Array(m*f*2);let y,v,M,A,k,x,T,B=0,z=0;for(y=0;y<f;y++){const t=y*_-c;for(v=0;v<m;v++)M=v*p-h,g[B]=M+s,g[B+1]=o,g[B+2]=-t+l,w[B+2]=-1,b[z]=v/d,b[z+1]=(u-y)/u,B+=3,z+=2}B=0;const E=new(g.length/3>65535?Uint32Array:Uint16Array)(d*u*6);for(y=0;y<u;y++)for(v=0;v<d;v++)A=v+m*y,k=v+m*(y+1),x=v+1+m*(y+1),T=v+1+m*y,E[B]=T,E[B+1]=k,E[B+2]=A,E[B+3]=T,E[B+4]=x,E[B+5]=k,B+=6;return{primitiveType:"triangles",positions:g,normals:w,uv:b,indices:E}}function buildSphereGeometry(t={}){const e=t.lod||1,a=t.center?t.center[0]:0,n=t.center?t.center[1]:0,i=t.center?t.center[2]:0;let r=t.radius||1;r<0&&(console.error("negative radius not allowed - will invert"),r*=-1);let s=t.heightSegments||18;s<0&&(console.error("negative heightSegments not allowed - will invert"),s*=-1),(s=Math.floor(e*s))<18&&(s=18);let o=t.widthSegments||18;o<0&&(console.error("negative widthSegments not allowed - will invert"),o*=-1),(o=Math.floor(e*o))<18&&(o=18);const l=[],h=[],c=[],d=[];let u,m,f,p,_,g,w,b,y,v,M,A,k,x,T;for(u=0;u<=s;u++)for(f=u*Math.PI/s,p=Math.sin(f),_=Math.cos(f),m=0;m<=o;m++)g=2*m*Math.PI/o,w=Math.sin(g),y=(b=Math.cos(g))*p,v=_,M=w*p,A=1-m/o,k=u/s,h.push(y),h.push(v),h.push(M),c.push(A),c.push(k),l.push(a+r*y),l.push(n+r*v),l.push(i+r*M);for(u=0;u<s;u++)for(m=0;m<o;m++)T=(x=u*(o+1)+m)+o+1,d.push(x+1),d.push(T+1),d.push(T),d.push(x+1),d.push(T),d.push(x);return{primitiveType:"triangles",positions:l,normals:h,uv:c,indices:d}}function buildTorusGeometry(t={}){let e=t.radius||1;e<0&&(console.error("negative radius not allowed - will invert"),e*=-1),e*=.5;let a=t.tube||.3;a<0&&(console.error("negative tube not allowed - will invert"),a*=-1);let n=t.radialSegments||32;n<0&&(console.error("negative radialSegments not allowed - will invert"),n*=-1),n<4&&(n=4);let i=t.tubeSegments||24;i<0&&(console.error("negative tubeSegments not allowed - will invert"),i*=-1),i<4&&(i=4);let r=t.arc||2*Math.PI;r<0&&(console.warn("negative arc not allowed - will invert"),r*=-1),r>360&&(r=360);const s=t.center;let o=s?s[0]:0,l=s?s[1]:0;const h=s?s[2]:0,c=[],d=[],u=[],m=[];let f,p,_,g,w,b,y,v,M,A,k,x;for(v=0;v<=i;v++)for(y=0;y<=n;y++)f=y/n*r,p=.785398+v/i*Math.PI*2,o=e*Math.cos(f),l=e*Math.sin(f),_=(e+a*Math.cos(p))*Math.cos(f),g=(e+a*Math.cos(p))*Math.sin(f),w=a*Math.sin(p),c.push(_+o),c.push(g+l),c.push(w+h),u.push(1-y/n),u.push(v/i),b=math.normalizeVec3(math.subVec3([_,g,w],[o,l,h],[]),[]),d.push(b[0]),d.push(b[1]),d.push(b[2]);for(v=1;v<=i;v++)for(y=1;y<=n;y++)M=(n+1)*v+y-1,A=(n+1)*(v-1)+y-1,k=(n+1)*(v-1)+y,x=(n+1)*v+y,m.push(M),m.push(A),m.push(k),m.push(k),m.push(x),m.push(M);return{primitiveType:"triangles",positions:c,normals:d,uv:u,indices:m}}const letters={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};function buildVectorTextGeometry(t={}){for(var e,a,n,i,r,s,o,l,h,c=t.origin||[0,0,0],d=c[0],u=c[1],m=c[2],f=t.size||1,p=[],_=[],g=((""+t.text).trim()||"").split("\n"),w=0,b=0,y=0;y<g.length;y++){e=0,n=(a=g[y]).length;for(var v=0;v<n;v++)if(i=letters[a.charAt(v)]){r=1,s=-1,o=-1,l=i.points.length;for(var M=0;M<l;M++)-1!==(h=i.points[M])[0]||-1!==h[1]?(p.push(e+h[0]*f*.04+d),p.push(b+h[1]*f*.04+u),p.push(0+m),-1===s?s=w:-1===o?o=w:(s=o,o=w),w++,r?r=!1:(_.push(s),_.push(o))):r=1;e+=.04*i.width*f}b-=35*.04*f}return{primitiveType:"lines",positions:p,indices:_}}exports.XKTModel=XKTModel,exports.buildBoxGeometry=buildBoxGeometry,exports.buildBoxLinesGeometry=buildBoxLinesGeometry,exports.buildCylinderGeometry=buildCylinderGeometry,exports.buildGridGeometry=buildGridGeometry,exports.buildPlaneGeometry=buildPlaneGeometry,exports.buildSphereGeometry=buildSphereGeometry,exports.buildTorusGeometry=buildTorusGeometry,exports.buildVectorTextGeometry=buildVectorTextGeometry,exports.parseGLTFIntoXKTModel=parseGLTFIntoXKTModel,exports.parseMetaModelIntoXKTModel=parseMetaModelIntoXKTModel,exports.writeXKTModelToArrayBuffer=writeXKTModelToArrayBuffer;
