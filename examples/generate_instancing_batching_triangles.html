<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>XKTModel - Generating a model programmatically, with combination of instanced and batched triangles
        geometry</title>
    <link href="css/styles.css" type="text/css" rel="stylesheet"/>

    <style>
        #myCanvas {
            width: 100%;
            height: 100%;
            background: lightBlue;
        }
    </style>

</head>

<body>
<canvas id="myCanvas"></canvas>
<div id="info">
    <h1>XKTModel - Generating a model programmatically, with combination of instanced and batched triangles
        geometry</h1><br>

    <div id="log">Loading JavaScript modules...</div>

</div>
</body>
<script type="module">

    import {
        Viewer,
        XKTLoaderPlugin
    } from "./build/xeokit-components.js";

    import {
        XKTModel,
        writeXKTModelToArrayBuffer,
        validateXKTArrayBuffer
    } from "./../dist/xeokit-xkt-utils.es.js";

    const viewer = new Viewer({
        canvasId: "myCanvas",
        transparent: true
    });

    viewer.scene.camera.eye = [-10.138146751746302, 3.9101748025397267, 22.601477943455837];
    viewer.scene.camera.look = [7.5, -5.750000000116415, 0];
    viewer.scene.camera.up = [0.18, 0.93, -0.25];

    viewer.cameraControl.navMode = "orbit";
    viewer.cameraControl.followPointer = true;

    function log(msg) {
        document.getElementById("log").innerHTML += "<br>" + msg;
    }

    log("Generating XKTModel..");

    const xktModel = new XKTModel();

    //------------------------------------------------------------------------------------------------------------------
    // Instancing
    //------------------------------------------------------------------------------------------------------------------

    // Create an XKTGeometry that defines a box shape, as a triangle mesh

    xktModel.createGeometry({
        geometryId: "boxGeometry",
        primitiveType: "triangles", // Also "lines" and "points"
        positions: [
            1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, 1, 1, -1, -1, 1,
            -1, -1, 1, 1, -1, 1, 1, -1, 1, -1, -1, -1, -1, -1, -1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, -1, -1, 1, 1, -1,
            -1, -1, -1, -1, -1, 1, -1, 1, 1, -1
        ],
        normals: [ // Only for "triangles"
            0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0,
            -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0,
            -1, 0, 0, -1
        ],
        indices: [
            0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19,
            20, 21, 22, 20, 22, 23
        ]
    });

    // Create five XKTMeshes, which represent the table top and legs.
    // Each XKTMesh has its own color, position, orientation and size,
    // and uses the XKTGeometry to define its shape.
    // An XKTGeometry can be used by multiple XKTMeshes.

    xktModel.createMesh({
        meshId: "redLegMesh",
        geometryId: "boxGeometry",
        position: [-4, -6, -4],
        scale: [1, 3, 1],
        rotation: [0, 0, 0],
        color: [1, 0, 0],
        opacity: 1
    });

    xktModel.createMesh({
        meshId: "greenLegMesh",
        geometryId: "boxGeometry",
        position: [4, -6, -4],
        scale: [1, 3, 1],
        rotation: [0, 0, 0],
        color: [0, 1, 0],
        opacity: 1
    });

    xktModel.createMesh({
        meshId: "blueLegMesh",
        geometryId: "boxGeometry",
        position: [4, -6, 4],
        scale: [1, 3, 1],
        rotation: [0, 0, 0],
        color: [0, 0, 1],
        opacity: 1
    });

    xktModel.createMesh({
        meshId: "yellowLegMesh",
        geometryId: "boxGeometry",
        position: [-4, -6, 4],
        scale: [1, 3, 1],
        rotation: [0, 0, 0],
        color: [1, 1, 0],
        opacity: 1
    });

    xktModel.createMesh({
        meshId: "pinkTopMesh",
        geometryId: "boxGeometry",
        position: [0, -3, 0],
        scale: [6, 0.5, 6],
        rotation: [0, 0, 0],
        color: [1, 0, 1],
        opacity: 1
    });

    // Create five XKTEntities, which represent abstract, named objects in the model.
    // Each XKTEntity has an XKTMesh.
    // An XKTEntity can have multiple XKTMeshes.
    // An XKTMesh can only belong to one XKTEntity.

    xktModel.createEntity({
        entityId: "redLeg",
        meshIds: ["redLegMesh"]
    });

    xktModel.createEntity({
        entityId: "greenLeg",
        meshIds: ["greenLegMesh"]
    });

    xktModel.createEntity({
        entityId: "blueLeg",
        meshIds: ["blueLegMesh"]
    });

    xktModel.createEntity({
        entityId: "yellowLeg",
        meshIds: ["yellowLegMesh"]
    });

    xktModel.createEntity({
        entityId: "pinkTop",
        meshIds: ["pinkTopMesh"]
    });

    //------------------------------------------------------------------------------------------------------------------
    // Batching
    //------------------------------------------------------------------------------------------------------------------

    // Create five XKTMeshes, which represent the table top and legs.

    // In this example, each XKTMesh gets its own XKTGeometry. Ordinarily, we would
    // share one XKTGeometry among all the XKTMeshes, but in this example we want
    // to test the case where there is no geometry reuse in the XKT.

    xktModel.createGeometry({
        geometryId: "redLegGeometryB",
        primitiveType: "triangles",
        positions: [
            1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, 1, 1, -1, -1, 1,
            -1, -1, 1, 1, -1, 1, 1, -1, 1, -1, -1, -1, -1, -1, -1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, -1, -1, 1, 1, -1,
            -1, -1, -1, -1, -1, 1, -1, 1, 1, -1
        ],
        normals: [ // Only for "triangles"
            0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0,
            -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0,
            -1, 0, 0, -1
        ],
        indices: [
            0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19,
            20, 21, 22, 20, 22, 23
        ]
    });

    xktModel.createMesh({
        meshId: "redLegMeshB",
        geometryId: "redLegGeometryB",
        position: [-4 + 15, -6, -4],
        scale: [1, 3, 1],
        rotation: [0, 0, 0],
        color: [1, 0, 0],
        opacity: 1
    });

    xktModel.createGeometry({
        geometryId: "greenLegGeometryB",
        primitiveType: "triangles",
        positions: [
            1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, 1, 1, -1, -1, 1,
            -1, -1, 1, 1, -1, 1, 1, -1, 1, -1, -1, -1, -1, -1, -1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, -1, -1, 1, 1, -1,
            -1, -1, -1, -1, -1, 1, -1, 1, 1, -1
        ],
        normals: [
            0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0,
            -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0,
            -1, 0, 0, -1
        ],
        indices: [
            0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19,
            20, 21, 22, 20, 22, 23
        ]
    });

    xktModel.createMesh({
        meshId: "greenLegMeshB",
        geometryId: "greenLegGeometryB",
        position: [4 + 15, -6, -4],
        scale: [1, 3, 1],
        rotation: [0, 0, 0],
        color: [0, 1, 0],
        opacity: 1
    });

    xktModel.createGeometry({
        geometryId: "blueLegGeometryB",
        primitiveType: "triangles",
        positions: [
            1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, 1, 1, -1, -1, 1,
            -1, -1, 1, 1, -1, 1, 1, -1, 1, -1, -1, -1, -1, -1, -1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, -1, -1, 1, 1, -1,
            -1, -1, -1, -1, -1, 1, -1, 1, 1, -1
        ],
        normals: [
            0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0,
            -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0,
            -1, 0, 0, -1
        ],
        indices: [
            0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19,
            20, 21, 22, 20, 22, 23
        ]
    });

    xktModel.createMesh({
        meshId: "blueLegMeshB",
        geometryId: "blueLegGeometryB",
        position: [4 + 15, -6, 4],
        scale: [1, 3, 1],
        rotation: [0, 0, 0],
        color: [0, 0, 1],
        opacity: 1
    });

    xktModel.createGeometry({
        geometryId: "yellowLegGeometryB",
        primitiveType: "triangles",
        positions: [
            1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, 1, 1, -1, -1, 1,
            -1, -1, 1, 1, -1, 1, 1, -1, 1, -1, -1, -1, -1, -1, -1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, -1, -1, 1, 1, -1,
            -1, -1, -1, -1, -1, 1, -1, 1, 1, -1
        ],
        normals: [
            0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0,
            -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0,
            -1, 0, 0, -1
        ],
        indices: [
            0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19,
            20, 21, 22, 20, 22, 23
        ]
    });

    xktModel.createMesh({
        meshId: "yellowLegMeshB",
        geometryId: "yellowLegGeometryB",
        position: [-4 + 15, -6, 4],
        scale: [1, 3, 1],
        rotation: [0, 0, 0],
        color: [1, 1, 0],
        opacity: 1
    });

    xktModel.createGeometry({
        geometryId: "pinkTopGeometryB",
        primitiveType: "triangles",
        positions: [
            1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, 1, 1, -1, -1, 1,
            -1, -1, 1, 1, -1, 1, 1, -1, 1, -1, -1, -1, -1, -1, -1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, -1, -1, 1, 1, -1,
            -1, -1, -1, -1, -1, 1, -1, 1, 1, -1
        ],
        normals: [
            0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0,
            -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0,
            -1, 0, 0, -1
        ],
        indices: [
            0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19,
            20, 21, 22, 20, 22, 23
        ]
    });

    xktModel.createMesh({
        meshId: "pinkTopMeshB",
        geometryId: "pinkTopGeometryB",
        position: [0 + 15, -3, 0],
        scale: [6, 0.5, 6],
        rotation: [0, 0, 0],
        color: [1, 0, 1],
        opacity: 1
    });

    // Create five XKTEntities, which represent abstract, named objects in the model.
    // Each XKTEntity has an XKTMesh.

    xktModel.createEntity({
        entityId: "redLegB",
        meshIds: ["redLegMeshB"]
    });

    xktModel.createEntity({
        entityId: "greenLegB",
        meshIds: ["greenLegMeshB"]
    });

    xktModel.createEntity({
        entityId: "blueLegB",
        meshIds: ["blueLegMeshB"]
    });

    xktModel.createEntity({
        entityId: "yellowLegB",
        meshIds: ["yellowLegMeshB"]
    });

    xktModel.createEntity({
        entityId: "pinkTopB",
        meshIds: ["pinkTopMeshB"]
    });

    xktModel.finalize();

    log("Writing XKTModel to array buffer..");

    const xktArrayBuffer = writeXKTModelToArrayBuffer(xktModel);

    log("Validating array buffer..");

    const xktArrayBufferValid = validateXKTArrayBuffer(xktArrayBuffer, xktModel);

    log(xktArrayBufferValid ? "VALID" : "ERRORS (see JS console for log)");

    log("Loading array buffer with XKTLoaderPlugin..");

    const xktLoader = new XKTLoaderPlugin(viewer);

    const model = xktLoader.load({
        id: "myModel",
        xkt: xktArrayBuffer,
        edges: true
    });

</script>
</html>